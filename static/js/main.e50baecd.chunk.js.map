{"version":3,"sources":["util/tubemap.js","enums.js","components/DataPositionFormRow.js","components/MountedDataFormRow.js","components/FileUploadFormRow.js","components/ExampleSelectButtons.js","components/HeaderForm.js","components/TubeMap.js","components/TubeMapContainer.js","components/RadioRow.js","components/CustomizationAccordion.js","App.js","index.js"],"names":["svgID","svg","zoom","nodes","tracks","reads","numberOfNodes","numberOfTracks","nodeMap","nodesPerOrder","maxOrder","trackForRuler","bed","dataOriginTypes","API","EXAMPLE_1","EXAMPLE_2","EXAMPLE_3","EXAMPLE_4","EXAMPLE_5","EXAMPLE_6","DEBUG","greys","blues","reds","plainColors","lightColors","haplotypeColors","forwardReadColors","reverseReadColors","exonColors","inputNodes","inputTracks","inputReads","assignments","extraLeft","extraRight","config","mergeNodesFlag","clickableNodesFlag","showExonsFlag","colorScheme","nodeWidthOption","showReads","showSoftClips","hideLegendFlag","colorReadsByMappingQuality","mappingQualityCutoff","trackRectangles","trackCurves","trackCorners","trackVerticalRectangles","trackRectanglesStep3","maxYCoordinate","minYCoordinate","maxXCoordinate","moveTrackToFirstPosition","index","unshift","splice","i","j","currentSequence","nodeName","nodesToInvert","sequence","length","charAt","substr","indexOf","push","concat","forEach","node","name","seq","split","reverse","join","straightenTrack","setColorSet","trackType","colorSet","createTubeMap","drawLegend","setNodeWidthOption","value","undefined","d3","selectAll","remove","JSON","parse","stringify","getColorSet","filter","read","is_secondary","mapping_quality","hasOwnProperty","type","hidden","generateNodeMap","generateTrackIndexSequences","generateNodeWidth","generateNodeSuccessors","generateNodeOrder","reverseReversedReads","nodeName2","tracksAndReads","pred","succ","Set","track","get","add","Array","from","sortedNodes","slice","sort","compareNodesByOrder","mergeOffset","Map","mergeOrigin","predecessor","mergeableWithPred","set","sequenceLength","firstNodeOffset","finalNodeCoverLength","mergeableWithSucc","sequenceNew","mismatches","mismatch","pos","donor","width","nodeIndex","mergeNodes","indexSequence","Math","abs","id","degree","console","log","max","order","getMaxOrder","allAreFour","round","freq","calculateTrackWidth","segmentNumber","currentNodeIndex","currentNodeIsForward","currentNode","previousNode","previousNodeIsForward","prevSegmentPerOrderPerTrack","isPositive","n","trackNo","path","lane","isForward","addToAssignment","generateSingleLaneAssignment","generateLaneAssignment","nodeStart","nodeEnd","feature","line","start","end","continue","features","addTrackFeatures","currentX","nextX","currentOrder","extra","leftSideEdges","rightSideEdges","calculateExtraSpace","x","pixelWidth","generateNodeXCoords","orderY","setMapToMax","y","contentHeight","step","generateReadOnlyNodeAttributes","generateBasicPathsForReads","incomingReads","outgoingReads","internalReads","idx","element","pathIdx","compareReadIncomingSegmentsByComingFrom","currentY","occupiedUntil","readElement","setOccupiedUntil","maxY","compareReadOutgoingSegmentsByGoingTo","occupiedFrom","has","incReadElementIndices","incRead","incReadPathElement","compareInternalReads","readIdx","currentRead","heightIncrease","adjustBy","assignmentNode","aNode","trackID","segmentID","adjustVertically3","bottomY","calculateBottomY","elementsWithoutNode","readIndex","pathIndex","previousY","compareNoNodeReadsByPreviousY","segment","placeReads","xStart","xEnd","yStart","yEnd","trackColor","highlight","dummy","reversalFlag","orderStartX","orderEndX","generateTrackColor","getXCoordinateOfBaseWithinNode","getReadXStart","createFeatureRectangle","min","color","laneChange","generateForwardToReverse","generateReverseToForward","getReadXEnd","generateSVGShapesFromPath","attr","document","getElementById","substring","parentNode","offsetWidth","minZoom","scaleExtent","translateExtent","on","transform","k","svg2","clientWidth","call","append","containerWidth","xOffset","translate","alignSVG","defs","pattern","attrs","height","patternUnits","patternTransform","fill","defineSVGPatterns","drawTrackRectangles","drawTrackCurves","drawReversalsByColor","dNodes","allNodes","removeUnusedNodes","d","data","enter","nodeMouseOver","nodeMouseOut","nodeDoubleClick","style","text","drawNodes","drawLabels","rulerTrackIndex","rulerTrack","markingInterval","indexOfFirstBaseInNode","indexOfFirstBase","atLeastOneMarkingDrawn","xCoordOfPreviousMarking","firstNode","drawRulerMarking","nextMarking","ceil","xCoordOfMarking","drawRuler","trackIdx","mm","nodeY","insertionMouseOver","insertionMouseOut","drawInsertion","x2","x1","deletionMouseOver","deletionMouseOut","drawDeletion","substitutionMouseOver","substitutionMouseOut","drawSubstitution","map","key","a","b","segmentA","segmentB","pathIndexA","pathIndexB","nodeA","nodeB","beginDiff","pathA","pathB","idxA","idxB","is_reverse","_loop","nodeWidth","getReverseComplement","temp","seqLength","s","result","tracksOrReads","zoomBy","zoomFactor","parentElement","translateK","translateX","translateY","transition","duration","scale","current","follower","successors","predecessors","generateNodeOrderOfSingleTrack","forwardOrder","backwardOrder","minOrder","increaseOrderForAllNodes","generateNodeOrderTrackBeginning","increment","anchorIndex","modifiedSequence","rightIndex","leftIndex","uninvert","increaseOrderForSuccessors","isSuccessor","first","second","visited","stack","pop","childIndex","amount","startingNode","tabuNode","newOrder","increasedOrders","queue","_loop2","shift","successor","compareToFromSame","assignment","currentLane","potentialAdjustmentValues","prevNameIsNull","prevTrack","idealLane","idealY","getIdealLanesAndCoords","compareByIdealLane","topLane","verticalAdjustment","minAdjustmentCost","Number","MAX_SAFE_INTEGER","moveBy","getVerticalAdjustmentCost","adjustVertically","colorSetName","base","nodeLeftX","nodeRightX","nodeXStart","nodeXEnd","rectXStart","c","co","featureXStart","featureXEnd","currentHighlight","trackWidth","yTop","yBottom","corners","rectangles","rect","filterObjectByAttribute","trackMouseOver","trackMouseOut","trackDoubleClick","drawTrackCorners","sequencePosition","xCoordinate","attribute","item","compareCurvesByLineChanges","myTrackCurves","curve","xMiddle","content","listeners","innerHTML","addEventListener","changeTrackVisibility","this","each","nodeID","click","vgExtractNodes","vg","getComputedTextLength","vgExtractTracks","isCompletelyReverse","mapping","position","node_id","index2","vgExtractReads","myNodes","myTracks","myReads","extracted","nodeNames","_loop3","firstIndex","lastIndex","edit","offset","toString","parseInt","posWithinNode","from_length","finalNodeEdit","predecessorIndex","successorIndex","ZOOM_FACTOR","DataPositionFormRow","handleZoomIn","tubeMap","handleZoomOut","handleDownloadButton","svgN","svgData","XMLSerializer","serializeToString","svgBlob","Blob","svgUrl","URL","createObjectURL","downloadLink","createElement","href","download","body","appendChild","removeChild","react_default","reactstrap_es","inline","className","for","size","props","onChange","handleInputChange","distance","byNode","uploadInProgress","onClick","handleGoButton","disabled","handleGoLeft","index_es","icon","faStepBackward","faSearchPlus","faSearchMinus","handleGoRight","faStepForward","Component","MountedDataFormRow","xgFileDropdownOptions","xgSelectOptions","fileName","gbwtFileDropdownOptions","gbwtSelectOptions","gamFileDropdownOptions","gamSelectOptions","pathDropdownOptions","pathSelectOptions","pathName","Fragment","xgSelect","gbwtSelect","gamSelect","pathSelect","BACKEND_URL","window","location","host","MAX_UPLOAD_SIZE","FileUploadFormRow","_this","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","onXgFileChange","file","xgFileInput","files","resetPathNames","handleFileUpload","showFileSizeAlert","setUploadInProgress","formData","FormData","xhr","XMLHttpRequest","responseType","onreadystatechange","readyState","status","response","getPathNames","open","send","onGbwtFileChange","gbwtFileInput","onGamFileChange","gamFileInput","React","createRef","accept","innerRef","ExampleSelectButtons","handleClick","dataOrigin","haploColor","readColor","setDataOrigin","setColorSetting","_this2","DATA_SOURCES","dataTypes","BUILT_IN","FILE_UPLOAD","MOUNTED_FILES","EXAMPLES","HeaderForm","state","xgFile","gbwtFile","gamFile","anchorTrackName","dataPath","dataType","fileSizeAlert","getMountedFilenames","_callee","json","regenerator_default","wrap","_context","prev","next","fetch","method","headers","Content-Type","sent","xgFiles","gbwtFiles","gamIndices","setState","includes","t0","stop","_callee2","isUploadedFile","_context2","pathNames","handleDataSourceChange","event","target","ds","useMountedPath","defaultPosition","fetchParams","setFetchParams","defineProperty","fileType","val","setUpWebsocket","ws","WebSocket","replace","onmessage","message","onclose","setTimeout","onerror","close","dataSourceDropdownOptions","mountedFilesFlag","uploadFilesFlag","examplesFlag","fluid","md","src","alt","components_MountedDataFormRow","components_FileUploadFormRow","isOpen","toggle","components_ExampleSelectButtons","components_DataPositionFormRow","TubeMap","params","clickableNodes","hideLegend","TubeMapContainer","isLoading","error","getRemoteTubeMapData","graph","gam","getExampleData","__webpack_require__","e","then","bind","inputTracks1","abrupt","inputTracks2","inputTracks3","inputTracks4","inputTracks5","k3138","readsFromStringToArray","demoReads","readsString","lines","prevProps","_this$state","components_TubeMap","colorMap","RadioRow","colorRadios","_ref","_ref2","slicedToArray","keyColor","valueColor","xs","check","checked","row","sm","rowHeading","VisualizationOptions","isOpenLegend","isOpenVisualizationOptions","toggleLegend","preventDefault","toggleVisOptions","handleMappingQualityCutoffChange","_this$props","visOptions","toggleFlag","mappingQualityOptions","keys","removeRedundantNodes","compressedView","components_RadioRow","App","toggleVisOptionFlag","flagName","objectSpread","components_HeaderForm","components_TubeMapContainer","CustomizationAccordion","ReactDOM","render","src_App_0"],"mappings":"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","file":"static/js/main.e50baecd.chunk.js","sourcesContent":["/* eslint no-param-reassign: \"off\" */\n/* eslint no-lonely-if: \"off\" */\n/* eslint no-prototype-builtins: \"off\" */\n/* eslint no-console: \"off\" */\n/* eslint no-continue: \"off\" */\n\n/* eslint max-len: \"off\" */\n/* eslint no-loop-func: \"off\" */\n/* eslint no-unused-vars: \"off\" */\n/* eslint no-return-assign: \"off\" */\nimport * as d3 from 'd3';\nimport 'd3-selection-multi';\n\nconst DEBUG = false;\n\nconst greys = [\n  '#d9d9d9',\n  '#bdbdbd',\n  '#969696',\n  '#737373',\n  '#525252',\n  '#252525',\n  '#000000'\n];\n\nconst blues = [\n  '#c6dbef',\n  '#9ecae1',\n  '#6baed6',\n  '#4292c6',\n  '#2171b5',\n  '#08519c',\n  '#08306b'\n];\n\nconst reds = [\n  '#fcbba1',\n  '#fc9272',\n  '#fb6a4a',\n  '#ef3b2c',\n  '#cb181d',\n  '#a50f15',\n  '#67000d'\n];\n\n// d3 category10\nconst plainColors = [\n  '#1f77b4',\n  '#ff7f0e',\n  '#2ca02c',\n  '#d62728',\n  '#9467bd',\n  '#8c564b',\n  '#e377c2',\n  '#7f7f7f',\n  '#bcbd22',\n  '#17becf'\n];\n\n// d3 category10\nconst lightColors = [\n  '#ABCCE3',\n  '#FFCFA5',\n  '#B0DBB0',\n  '#F0AEAE',\n  '#D7C6E6',\n  '#C6ABA5',\n  '#F4CCE8',\n  '#CFCFCF',\n  '#E6E6AC',\n  '#A8E7ED'\n];\n\nlet haplotypeColors = [];\nlet forwardReadColors = [];\nlet reverseReadColors = [];\nlet exonColors = [];\n\nlet svgID; // the (html-tag) ID of the svg\nlet svg; // the svg\nexport let zoom; // eslint-disable-line import/no-mutable-exports\nlet inputNodes = [];\nlet inputTracks = [];\nlet inputReads = [];\nlet nodes;\nlet tracks;\nlet reads;\nlet numberOfNodes;\nlet numberOfTracks;\nlet nodeMap; // maps node names to node indices\nlet nodesPerOrder;\nlet assignments = []; // contains info about lane assignments sorted by order\nlet extraLeft = []; // info whether nodes have to be moved further apart because of multiple 180 directional changes at the same horizontal order\nlet extraRight = []; // info whether nodes have to be moved further apart because of multiple 180 directional changes at the same horizontal order\nlet maxOrder; // horizontal order of the rightmost node\n\nconst config = {\n  mergeNodesFlag: true,\n  clickableNodesFlag: false,\n  showExonsFlag: false,\n  colorScheme: 0,\n  // Options for the width of sequence nodes:\n  // 0...scale node width linear with number of bases within node\n  // 1...scale node width with log2 of number of bases within node\n  // 2...scale node width with log10 of number of bases within node\n  nodeWidthOption: 0,\n  showReads: true,\n  showSoftClips: true,\n  haplotypeColors: 'greys',\n  forwardReadColors: 'reds',\n  reverseReadColors: 'blues',\n  exonColors: 'lightColors',\n  hideLegendFlag: false,\n  colorReadsByMappingQuality: false,\n  mappingQualityCutoff: 0\n};\n\n// variables for storing info which can be directly translated into drawing instructions\nlet trackRectangles = [];\nlet trackCurves = [];\nlet trackCorners = [];\nlet trackVerticalRectangles = []; // stored separately from horizontal rectangles. This allows drawing them in a separate step -> avoids issues with wrong overlapping\nlet trackRectanglesStep3 = [];\n\nlet maxYCoordinate = 0;\nlet minYCoordinate = 0;\nlet maxXCoordinate = 0;\nlet trackForRuler;\n\nlet bed;\n\n// main function to call from outside\n// which starts the process of creating a tube map visualization\nexport function create(params) {\n  // mandatory parameters: svgID, nodes, tracks\n  // optional parameters: bed, clickableNodes, reads, showLegend\n  svgID = params.svgID;\n  svg = d3.select(params.svgID);\n  inputNodes = JSON.parse(JSON.stringify(params.nodes)); // deep copy\n  inputTracks = JSON.parse(JSON.stringify(params.tracks)); // deep copy\n  inputReads = params.reads || null;\n  bed = params.bed || null;\n  config.clickableNodesFlag = params.clickableNodes || false;\n  config.hideLegendFlag = params.hideLegend || false;\n  const tr = createTubeMap();\n  if (!config.hideLegendFlag) drawLegend(tr);\n}\n\n// moves a specific track to the top\nfunction moveTrackToFirstPosition(index) {\n  inputTracks.unshift(inputTracks[index]); // add element to beginning\n  inputTracks.splice(index + 1, 1); // remove 1 element from the middle\n  straightenTrack(0);\n}\n\n// straighten track given by index by inverting inverted nodes\n// only keep them inverted if this single track runs thrugh them in both directions\nfunction straightenTrack(index) {\n  let i;\n  let j;\n  const nodesToInvert = [];\n  let currentSequence;\n  let nodeName;\n\n  // find out which nodes should be inverted\n  currentSequence = inputTracks[index].sequence;\n  for (i = 0; i < currentSequence.length; i += 1) {\n    if (currentSequence[i].charAt(0) === '-') {\n      nodeName = currentSequence[i].substr(1);\n      if (\n        currentSequence.indexOf(nodeName) === -1 ||\n        currentSequence.indexOf(nodeName) > i\n      ) {\n        // only if this inverted node is no repeat\n        nodesToInvert.push(currentSequence[i].substr(1));\n      }\n    }\n  }\n\n  // invert nodes in the tracks' sequence\n  for (i = 0; i < inputTracks.length; i += 1) {\n    currentSequence = inputTracks[i].sequence;\n    for (j = 0; j < currentSequence.length; j += 1) {\n      if (currentSequence[j].charAt(0) !== '-') {\n        if (nodesToInvert.indexOf(currentSequence[j]) !== -1) {\n          currentSequence[j] = `-${currentSequence[j]}`;\n        }\n      } else if (nodesToInvert.indexOf(currentSequence[j].substr(1)) !== -1) {\n        currentSequence[j] = currentSequence[j].substr(1);\n      }\n    }\n  }\n\n  // invert the sequence within the nodes\n  inputNodes.forEach(node => {\n    if (nodesToInvert.indexOf(node.name) !== -1) {\n      node.seq = node.seq\n        .split('')\n        .reverse()\n        .join('');\n    }\n  });\n}\n\nexport function changeTrackVisibility(trackID) {\n  let i = 0;\n  while (i < inputTracks.length && inputTracks[i].id !== trackID) i += 1;\n  if (i < inputTracks.length) {\n    if (inputTracks[i].hasOwnProperty('hidden')) {\n      inputTracks[i].hidden = !inputTracks[i].hidden;\n    } else {\n      inputTracks[i].hidden = true;\n    }\n  }\n  createTubeMap();\n}\n\nexport function changeExonVisibility() {\n  config.showExonsFlag = !config.showExonsFlag;\n  createTubeMap();\n}\n\n// sets the flag for whether redundant nodes should be automatically removed or not\nexport function setMergeNodesFlag(value) {\n  if (config.mergeNodesFlag !== value) {\n    config.mergeNodesFlag = value;\n    svg = d3.select(svgID);\n    createTubeMap();\n  }\n}\n\n// sets the flag for whether read soft clips should be displayed or not\nexport function setSoftClipsFlag(value) {\n  if (config.showSoftClips !== value) {\n    config.showSoftClips = value;\n    svg = d3.select(svgID);\n    createTubeMap();\n  }\n}\n\n// sets the flag for whether reads should be displayed or not\nexport function setShowReadsFlag(value) {\n  if (config.showReads !== value) {\n    config.showReads = value;\n    svg = d3.select(svgID);\n    createTubeMap();\n  }\n}\n\nexport function setColorSet(trackType, colorSet) {\n  if (config[trackType] !== colorSet) {\n    config[trackType] = colorSet;\n    const tr = createTubeMap();\n    if (!config.hideLegendFlag) drawLegend(tr);\n  }\n}\n\n// sets which option should be used for calculating the node width from its sequence length\nexport function setNodeWidthOption(value) {\n  if (value === 0 || value === 1 || value === 2) {\n    if (config.nodeWidthOption !== value) {\n      config.nodeWidthOption = value;\n      if (svg !== undefined) {\n        svg = d3.select(svgID);\n        createTubeMap();\n      }\n    }\n  }\n}\n\nexport function setColorReadsByMappingQualityFlag(value) {\n  if (config.colorReadsByMappingQuality !== value) {\n    config.colorReadsByMappingQuality = value;\n    svg = d3.select(svgID);\n    createTubeMap();\n  }\n}\n\nexport function setMappingQualityCutoff(value) {\n  if (config.mappingQualityCutoff !== value) {\n    config.mappingQualityCutoff = value;\n    if (svg !== undefined) {\n      svg = d3.select(svgID);\n      createTubeMap();\n    }\n  }\n}\n\n// main\nfunction createTubeMap() {\n  trackRectangles = [];\n  trackCurves = [];\n  trackCorners = [];\n  trackVerticalRectangles = [];\n  trackRectanglesStep3 = [];\n  assignments = [];\n  extraLeft = [];\n  extraRight = [];\n  maxYCoordinate = 0;\n  minYCoordinate = 0;\n  maxXCoordinate = 0;\n  trackForRuler = undefined;\n  svg = d3.select(svgID);\n  svg.selectAll('*').remove(); // clear svg for (re-)drawing\n\n  nodes = JSON.parse(JSON.stringify(inputNodes)); // deep copy (can add stuff to copy and leave original unchanged)\n  tracks = JSON.parse(JSON.stringify(inputTracks));\n  reads = JSON.parse(JSON.stringify(inputReads));\n\n  // early exit is necessary when visualization options such as colors are\n  // changed before any graph has been rendered\n  if (nodes.length === 0 || tracks.length === 0) return;\n\n  assignColorSets();\n  reads = filterReads(reads);\n\n  for (let i = tracks.length - 1; i >= 0; i -= 1) {\n    if (!tracks[i].hasOwnProperty('type')) {\n      // TODO: maybe remove \"haplo\"-property?\n      tracks[i].type = 'haplo';\n    }\n    if (tracks[i].hasOwnProperty('hidden')) {\n      if (tracks[i].hidden === true) {\n        tracks.splice(i, 1);\n      }\n    }\n    if (tracks[i] && tracks[i].hasOwnProperty('indexOfFirstBase')) {\n      trackForRuler = tracks[i].name;\n    }\n  }\n  if (tracks.length === 0) return;\n\n  nodeMap = generateNodeMap(nodes);\n  generateTrackIndexSequences(tracks);\n  if (reads && config.showReads) generateTrackIndexSequences(reads);\n  generateNodeWidth();\n\n  if (config.mergeNodesFlag) {\n    generateNodeSuccessors(); // requires indexSequence\n    generateNodeOrder(); // requires successors\n    if (reads && config.showReads) reverseReversedReads();\n    mergeNodes();\n    nodeMap = generateNodeMap(nodes);\n    generateNodeWidth();\n    generateTrackIndexSequences(tracks);\n    if (reads && config.showReads) generateTrackIndexSequences(reads);\n  }\n\n  numberOfNodes = nodes.length;\n  numberOfTracks = tracks.length;\n  generateNodeSuccessors();\n  generateNodeDegree();\n  if (DEBUG) console.log(`${numberOfNodes} nodes.`);\n  generateNodeOrder();\n  maxOrder = getMaxOrder();\n\n  // can cause problems when there is a reversed single track node\n  // OTOH, can solve problems with complex inversion patterns\n  // switchNodeOrientation();\n  // generateNodeOrder(nodes, tracks);\n  // maxOrder = getMaxOrder();\n\n  calculateTrackWidth(tracks);\n  generateLaneAssignment();\n\n  if (config.showExonsFlag === true && bed !== null) addTrackFeatures();\n  generateNodeXCoords();\n\n  if (reads && config.showReads) {\n    generateReadOnlyNodeAttributes();\n    reverseReversedReads();\n    generateTrackIndexSequences(reads);\n    placeReads();\n    tracks = tracks.concat(reads);\n  }\n\n  generateSVGShapesFromPath(nodes, tracks);\n  if (DEBUG) {\n    console.log('Tracks:');\n    console.log(tracks);\n    console.log('Nodes:');\n    console.log(nodes);\n    console.log('Lane assignment:');\n    console.log(assignments);\n  }\n  getImageDimensions();\n  alignSVG(nodes, tracks);\n  defineSVGPatterns();\n\n  drawTrackRectangles(trackRectangles);\n  drawTrackCurves();\n  drawReversalsByColor(trackCorners, trackVerticalRectangles);\n  drawTrackRectangles(trackRectanglesStep3);\n  drawTrackRectangles(trackRectangles, 'read');\n  drawTrackCurves('read');\n\n  // draw only those nodes which have coords assigned to them\n  const dNodes = removeUnusedNodes(nodes);\n  drawReversalsByColor(trackCorners, trackVerticalRectangles, 'read');\n  drawNodes(dNodes);\n  if (config.nodeWidthOption === 0) drawLabels(dNodes);\n  if (trackForRuler !== undefined) drawRuler();\n  if (config.nodeWidthOption === 0) drawMismatches(); // TODO: call this before drawLabels and fix d3 data/append/enter stuff\n  if (DEBUG) {\n    console.log(`number of tracks: ${numberOfTracks}`);\n    console.log(`number of nodes: ${numberOfNodes}`);\n  }\n  return tracks;\n}\n\n// generates attributes (node.y, node.contentHeight) for nodes without tracks, only reads\nfunction generateReadOnlyNodeAttributes() {\n  nodesPerOrder = [];\n  for (let i = 0; i <= maxOrder; i += 1) {\n    nodesPerOrder[i] = [];\n  }\n\n  const orderY = new Map();\n  nodes.forEach(node => {\n    if (node.hasOwnProperty('order') && node.hasOwnProperty('y')) {\n      setMapToMax(orderY, node.order, node.y + node.contentHeight);\n    }\n  });\n\n  // for order values where there is no node with haplotypes, orderY is calculated via tracks\n  tracks.forEach(track => {\n    if (track.type === 'haplo') {\n      track.path.forEach(step => {\n        setMapToMax(orderY, step.order, step.y + track.width);\n      });\n    }\n  });\n\n  nodes.forEach((node, i) => {\n    if (node.hasOwnProperty('order') && !node.hasOwnProperty('y')) {\n      node.y = orderY.get(node.order) + 25;\n      node.contentHeight = 0;\n      nodesPerOrder[node.order].push(i);\n    }\n  });\n}\n\nfunction setMapToMax(map, key, value) {\n  if (map.has(key)) {\n    map.set(key, Math.max(map.get(key), value));\n  } else {\n    map.set(key, value);\n  }\n}\n\n// add info about reads to nodes (incoming, outgoing and internal reads)\nfunction assignReadsToNodes() {\n  nodes.forEach(node => {\n    node.incomingReads = [];\n    node.outgoingReads = [];\n    node.internalReads = [];\n  });\n  reads.forEach((read, idx) => {\n    read.width = 7;\n    if (read.path.length === 1) {\n      nodes[read.path[0].node].internalReads.push(idx);\n    } else {\n      read.path.forEach((element, pathIdx) => {\n        if (pathIdx === 0) {\n          nodes[read.path[0].node].outgoingReads.push([idx, pathIdx]);\n        } else if (read.path[pathIdx].node !== null) {\n          nodes[read.path[pathIdx].node].incomingReads.push([idx, pathIdx]);\n        }\n      });\n    }\n  });\n}\n\nfunction removeNonPathNodesFromReads() {\n  reads.forEach(read => {\n    for (let i = read.sequence.length - 1; i >= 0; i -= 1) {\n      let nodeName = read.sequence[i];\n      if (nodeName.charAt(0) === '-') {\n        nodeName = nodeName.substr(1);\n      }\n      if (!nodeMap.has(nodeName) || nodes[nodeMap.get(nodeName)].degree === 0) {\n        read.sequence.splice(i, 1);\n      }\n    }\n  });\n}\n\n// calculate paths (incl. correct y coordinate) for all reads\nfunction placeReads() {\n  generateBasicPathsForReads();\n  assignReadsToNodes();\n\n  // sort nodes by order, then by y-coordinate\n  const sortedNodes = nodes.slice();\n  sortedNodes.sort(compareNodesByOrder);\n\n  // iterate over all nodes\n  sortedNodes.forEach(node => {\n    // sort incoming reads\n    node.incomingReads.sort(compareReadIncomingSegmentsByComingFrom);\n\n    // place incoming reads\n    let currentY = node.y + node.contentHeight;\n    const occupiedUntil = new Map();\n    node.incomingReads.forEach(readElement => {\n      reads[readElement[0]].path[readElement[1]].y = currentY;\n      setOccupiedUntil(\n        occupiedUntil,\n        reads[readElement[0]],\n        readElement[1],\n        currentY,\n        node\n      );\n      currentY += 7;\n    });\n    let maxY = currentY;\n\n    // sort outgoing reads\n    node.outgoingReads.sort(compareReadOutgoingSegmentsByGoingTo);\n\n    // place outgoing reads\n    const occupiedFrom = new Map();\n    currentY = node.y + node.contentHeight;\n    node.outgoingReads.forEach(readElement => {\n      // place in next lane\n      reads[readElement[0]].path[readElement[1]].y = currentY;\n      occupiedFrom.set(currentY, reads[readElement[0]].firstNodeOffset);\n      // if no conflicts\n      if (\n        !occupiedUntil.has(currentY) ||\n        occupiedUntil.get(currentY) + 1 < reads[readElement[0]].firstNodeOffset\n      ) {\n        currentY += 7;\n        maxY = Math.max(maxY, currentY);\n      } else {\n        // otherwise push down incoming reads to make place for outgoing Read\n        occupiedUntil.set(currentY, 0);\n        node.incomingReads.forEach(incReadElementIndices => {\n          const incRead = reads[incReadElementIndices[0]];\n          const incReadPathElement = incRead.path[incReadElementIndices[1]];\n          if (incReadPathElement.y >= currentY) {\n            incReadPathElement.y += 7;\n            setOccupiedUntil(\n              occupiedUntil,\n              incRead,\n              incReadElementIndices[1],\n              incReadPathElement.y,\n              node\n            );\n          }\n        });\n        currentY += 7;\n        maxY += 7;\n      }\n    });\n\n    // sort internal reads\n    node.internalReads.sort(compareInternalReads);\n\n    // place internal reads\n    node.internalReads.forEach(readIdx => {\n      const currentRead = reads[readIdx];\n      currentY = node.y + node.contentHeight;\n      while (\n        currentRead.firstNodeOffset < occupiedUntil.get(currentY) + 2 ||\n        currentRead.finalNodeCoverLength > occupiedFrom.get(currentY) - 3\n      ) {\n        currentY += 7;\n      }\n      currentRead.path[0].y = currentY;\n      occupiedUntil.set(currentY, currentRead.finalNodeCoverLength);\n      maxY = Math.max(maxY, currentY);\n    });\n\n    // adjust node height and move other nodes vertically down\n    const heightIncrease = maxY - node.y - node.contentHeight;\n    node.contentHeight += heightIncrease;\n    adjustVertically3(node, heightIncrease);\n  });\n\n  // place read segments which are without node\n  const bottomY = calculateBottomY();\n  const elementsWithoutNode = [];\n  reads.forEach((read, idx) => {\n    read.path.forEach((element, pathIdx) => {\n      if (!element.hasOwnProperty('y')) {\n        elementsWithoutNode.push({\n          readIndex: idx,\n          pathIndex: pathIdx,\n          previousY: reads[idx].path[pathIdx - 1].y\n        });\n      }\n    });\n  });\n  elementsWithoutNode.sort(compareNoNodeReadsByPreviousY);\n  elementsWithoutNode.forEach(element => {\n    const segment = reads[element.readIndex].path[element.pathIndex];\n    segment.y = bottomY[segment.order];\n    bottomY[segment.order] += reads[element.readIndex].width;\n  });\n\n  if (DEBUG) {\n    console.log('Reads:');\n    console.log(reads);\n  }\n}\n\n// keeps track of where reads end within nodes\nfunction setOccupiedUntil(map, read, pathIndex, y, node) {\n  if (pathIndex === read.path.length - 1) {\n    // last node of current read\n    map.set(y, read.finalNodeCoverLength);\n  } else {\n    // read covers the whole node\n    map.set(y, node.sequenceLength);\n  }\n}\n\n// compare read segments which are outside of nodes\n// by the y-coord of where they are coming from\nfunction compareNoNodeReadsByPreviousY(a, b) {\n  const segmentA = reads[a.readIndex].path[a.pathIndex];\n  const segmentB = reads[b.readIndex].path[b.pathIndex];\n  if (segmentA.order === segmentB.order) {\n    return a.previousY - b.previousY;\n  }\n  return segmentA.order - segmentB.order;\n}\n\n// compare read segments by where they are going to\nfunction compareReadOutgoingSegmentsByGoingTo(a, b) {\n  let pathIndexA = a[1];\n  let pathIndexB = b[1];\n  // let readA = reads[a[0]]\n  // let nodeIndexA = readA.path[pathIndexA].node;\n  let nodeA = nodes[reads[a[0]].path[pathIndexA].node];\n  let nodeB = nodes[reads[b[0]].path[pathIndexB].node];\n  while (nodeA !== null && nodeB !== null && nodeA === nodeB) {\n    if (pathIndexA < reads[a[0]].path.length - 1) {\n      pathIndexA += 1;\n      while (reads[a[0]].path[pathIndexA].node === null) pathIndexA += 1; // skip null nodes in path\n      nodeA = nodes[reads[a[0]].path[pathIndexA].node];\n    } else {\n      nodeA = null;\n    }\n    if (pathIndexB < reads[b[0]].path.length - 1) {\n      pathIndexB += 1;\n      while (reads[b[0]].path[pathIndexB].node === null) pathIndexB += 1; // skip null nodes in path\n      nodeB = nodes[reads[b[0]].path[pathIndexB].node];\n    } else {\n      nodeB = null;\n    }\n  }\n  if (nodeA !== null) {\n    if (nodeB !== null) return compareNodesByOrder(nodeA, nodeB);\n    return 1; // nodeB is null, nodeA not null\n  }\n  if (nodeB !== null) return -1; // nodeB not null, nodeA null\n  // both nodes are null -> both end in the same node\n  const beginDiff = reads[a[0]].firstNodeOffset - reads[b[0]].firstNodeOffset;\n  if (beginDiff !== 0) return beginDiff;\n  // break tie: both reads cover the same nodes and begin at the same position -> compare by endPosition\n  return reads[a[0]].finalNodeCoverLength - reads[b[0]].finalNodeCoverLength;\n}\n\n// compare read segments by (y-coord of) where they are coming from\nfunction compareReadIncomingSegmentsByComingFrom(a, b) {\n  // these boundary conditions avoid errors for incoming reads\n  // from inverted nodes (u-turns)\n  if (a[1] === 0) return -1;\n  if (b[1] === 0) return 1;\n\n  const pathA = reads[a[0]].path[a[1] - 1];\n  const pathB = reads[b[0]].path[b[1] - 1];\n  if (pathA.hasOwnProperty('y')) {\n    if (pathB.hasOwnProperty('y')) {\n      return pathA.y - pathB.y; // a and b have y-property\n    }\n    return -1; // only a has y-property\n  }\n  if (pathB.hasOwnProperty('y')) {\n    return 1; // only b has y-property\n  }\n  return compareReadIncomingSegmentsByComingFrom(\n    [a[0], a[1] - 1],\n    [b[0], b[1] - 1]\n  ); // neither has y-property\n}\n\n// compare 2 reads which are completely within a single node\nfunction compareInternalReads(idxA, idxB) {\n  const a = reads[idxA];\n  const b = reads[idxB];\n  // compare by first base within first node\n  if (a.firstNodeOffset < b.firstNodeOffset) return -1;\n  else if (a.firstNodeOffset > b.firstNodeOffset) return 1;\n\n  // compare by last base within last node\n  if (a.finalNodeCoverLength < b.finalNodeCoverLength) return -1;\n  else if (a.finalNodeCoverLength > b.finalNodeCoverLength) return 1;\n\n  return 0;\n}\n\n// determine biggest y-coordinate for each order-value\nfunction calculateBottomY() {\n  const bottomY = [];\n  for (let i = 0; i <= maxOrder; i += 1) {\n    bottomY.push(0);\n  }\n\n  nodes.forEach(node => {\n    bottomY[node.order] = Math.max(\n      bottomY[node.order],\n      node.y + node.contentHeight + 20\n    );\n  });\n\n  tracks.forEach(track => {\n    track.path.forEach(element => {\n      bottomY[element.order] = Math.max(\n        bottomY[element.order],\n        element.y + track.width\n      );\n    });\n  });\n  return bottomY;\n}\n\n// generate path-info for each read\n// containing order, node and orientation, but no concrete coordinates\nfunction generateBasicPathsForReads() {\n  let currentNodeIndex;\n  let currentNodeIsForward;\n  let currentNode;\n  let previousNode;\n  let previousNodeIsForward;\n  const isPositive = n => ((n = +n) || 1 / n) >= 0;\n\n  reads.forEach(read => {\n    // add info for start of track\n    currentNodeIndex = Math.abs(read.indexSequence[0]);\n    currentNodeIsForward = isPositive(read.indexSequence[0]);\n    currentNode = nodes[currentNodeIndex];\n\n    read.path = [];\n    read.path.push({\n      order: currentNode.order,\n      isForward: currentNodeIsForward,\n      node: currentNodeIndex\n    });\n\n    for (let i = 1; i < read.sequence.length; i += 1) {\n      previousNode = currentNode;\n      previousNodeIsForward = currentNodeIsForward;\n\n      currentNodeIndex = Math.abs(read.indexSequence[i]);\n      currentNodeIsForward = isPositive(read.indexSequence[i]);\n      currentNode = nodes[currentNodeIndex];\n\n      if (currentNode.order > previousNode.order) {\n        if (!previousNodeIsForward) {\n          // backward to forward at previous node\n          read.path.push({\n            order: previousNode.order,\n            isForward: true,\n            node: null\n          });\n        }\n        for (let j = previousNode.order + 1; j < currentNode.order; j += 1) {\n          // forward without nodes\n          read.path.push({ order: j, isForward: true, node: null });\n        }\n        if (!currentNodeIsForward) {\n          // forward to backward at current node\n          read.path.push({\n            order: currentNode.order,\n            isForward: true,\n            node: null\n          });\n          read.path.push({\n            order: currentNode.order,\n            isForward: false,\n            node: currentNodeIndex\n          });\n        } else {\n          // current Node forward\n          read.path.push({\n            order: currentNode.order,\n            isForward: true,\n            node: currentNodeIndex\n          });\n        }\n      } else if (currentNode.order < previousNode.order) {\n        if (previousNodeIsForward) {\n          // turnaround from fw to bw at previous node\n          read.path.push({\n            order: previousNode.order,\n            isForward: false,\n            node: null\n          });\n        }\n        for (let j = previousNode.order - 1; j > currentNode.order; j -= 1) {\n          // bachward without nodes\n          read.path.push({ order: j, isForward: false, node: null });\n        }\n        if (currentNodeIsForward) {\n          // backward to forward at current node\n          read.path.push({\n            order: currentNode.order,\n            isForward: false,\n            node: null\n          });\n          read.path.push({\n            order: currentNode.order,\n            isForward: true,\n            node: currentNodeIndex\n          });\n        } else {\n          // backward at current node\n          read.path.push({\n            order: currentNode.order,\n            isForward: false,\n            node: currentNodeIndex\n          });\n        }\n      } else {\n        if (currentNodeIsForward !== previousNodeIsForward) {\n          read.path.push({\n            order: currentNode.order,\n            isForward: currentNodeIsForward,\n            node: currentNodeIndex\n          });\n        } else {\n          read.path.push({\n            order: currentNode.order,\n            isForward: !currentNodeIsForward,\n            node: null\n          });\n          read.path.push({\n            order: currentNode.order,\n            isForward: currentNodeIsForward,\n            node: currentNodeIndex\n          });\n        }\n      }\n    }\n  });\n}\n\n// reverse reads which are reversed\nfunction reverseReversedReads() {\n  reads.forEach(read => {\n    let pos = 0;\n    while (pos < read.sequence.length && read.sequence[pos].charAt(0) === '-') {\n      pos += 1;\n    }\n    if (pos === read.sequence.length) {\n      // completely reversed read\n      read.is_reverse = true;\n      read.sequence = read.sequence.reverse(); // invert sequence\n      for (let i = 0; i < read.sequence.length; i += 1) {\n        read.sequence[i] = read.sequence[i].substr(1); // remove '-'\n      }\n\n      read.sequenceNew = read.sequenceNew.reverse(); // invert sequence\n      for (let i = 0; i < read.sequenceNew.length; i += 1) {\n        read.sequenceNew[i].nodeName = read.sequenceNew[i].nodeName.substr(1); // remove '-'\n        const nodeWidth =\n          nodes[nodeMap.get(read.sequenceNew[i].nodeName)].width;\n        read.sequenceNew[i].mismatches.forEach(mm => {\n          if (mm.type === 'insertion') {\n            mm.pos = nodeWidth - mm.pos;\n            mm.seq = getReverseComplement(mm.seq);\n          } else if (mm.type === 'deletion') {\n            mm.pos = nodeWidth - mm.pos - mm.length;\n          } else if (mm.type === 'substitution') {\n            mm.pos = nodeWidth - mm.pos - mm.seq.length;\n            mm.seq = getReverseComplement(mm.seq);\n          }\n          if (mm.hasOwnProperty('seq')) {\n            mm.seq = mm.seq\n              .split('')\n              .reverse()\n              .join('');\n          }\n        });\n      }\n\n      // adjust firstNodeOffset and finalNodeCoverLength\n      const temp = read.firstNodeOffset;\n      let seqLength = nodes[nodeMap.get(read.sequence[0])].sequenceLength;\n      read.firstNodeOffset = seqLength - read.finalNodeCoverLength;\n      seqLength =\n        nodes[nodeMap.get(read.sequence[read.sequence.length - 1])]\n          .sequenceLength;\n      read.finalNodeCoverLength = seqLength - temp;\n    }\n  });\n}\n\nfunction getReverseComplement(s) {\n  let result = '';\n  for (let i = s.length - 1; i >= 0; i -= 1) {\n    switch (s.charAt(i)) {\n      case 'A':\n        result += 'T';\n        break;\n      case 'T':\n        result += 'A';\n        break;\n      case 'C':\n        result += 'G';\n        break;\n      case 'G':\n        result += 'C';\n        break;\n      default:\n        result += 'N';\n    }\n  }\n  return result;\n}\n\n// for each track: generate sequence of node indices from seq. of node names\nfunction generateTrackIndexSequencesNEW(tracksOrReads) {\n  tracksOrReads.forEach(track => {\n    track.indexSequence = [];\n    track.sequence.forEach(edit => {\n      if (edit.nodeName.charAt(0) === '-') {\n        track.indexSequence.push(-nodeMap.get(edit.nodeName.substr(1)));\n      } else {\n        track.indexSequence.push(nodeMap.get(edit.nodeName));\n      }\n    });\n  });\n}\n\n// for each track: generate sequence of node indices from seq. of node names\nfunction generateTrackIndexSequences(tracksOrReads) {\n  tracksOrReads.forEach(track => {\n    track.indexSequence = [];\n    track.sequence.forEach(nodeName => {\n      if (nodeName.charAt(0) === '-') {\n        track.indexSequence.push(-nodeMap.get(nodeName.substr(1)));\n      } else {\n        track.indexSequence.push(nodeMap.get(nodeName));\n      }\n    });\n  });\n}\n\n// remove nodes with no tracks moving through them to avoid d3.js errors\nfunction removeUnusedNodes(allNodes) {\n  const dNodes = allNodes.slice(0);\n  let i;\n  for (i = dNodes.length - 1; i >= 0; i -= 1) {\n    if (!dNodes[i].hasOwnProperty('x')) {\n      dNodes.splice(i, 1);\n    }\n  }\n  return dNodes;\n}\n\n// get the minimum and maximum coordinates used in the image to calculate image dimensions\nfunction getImageDimensions() {\n  maxXCoordinate = -99;\n  minYCoordinate = 99;\n  maxYCoordinate = -99;\n\n  nodes.forEach(node => {\n    if (node.hasOwnProperty('x')) {\n      maxXCoordinate = Math.max(maxXCoordinate, node.x + 20 + node.pixelWidth);\n    }\n    if (node.hasOwnProperty('y')) {\n      minYCoordinate = Math.min(minYCoordinate, node.y - 10);\n      maxYCoordinate = Math.max(\n        maxYCoordinate,\n        node.y + node.contentHeight + 10\n      );\n    }\n  });\n\n  tracks.forEach(track => {\n    track.path.forEach(segment => {\n      maxYCoordinate = Math.max(maxYCoordinate, segment.y + track.width);\n      minYCoordinate = Math.min(minYCoordinate, segment.y);\n    });\n  });\n}\n\n// align visualization to the top and left within svg and resize svg to correct size\n// enable zooming and panning\nfunction alignSVG() {\n  svg.attr('height', maxYCoordinate - minYCoordinate + 50);\n  svg.attr(\n    'width',\n    document.getElementById(svgID.substring(1)).parentNode.offsetWidth\n  );\n\n  function zoomed() {\n    const transform = d3.event.transform;\n    // vertical adjustment so that top of graph is at top of svg\n    // otherwise would violate translateExtent, which leads to graph \"jumping\" on next pan\n    transform.y = (25 - minYCoordinate) * transform.k;\n    svg.attr('transform', transform);\n    const svg2 = d3.select(svgID);\n    // adjust height, so that vertical scroll bar is shown when necessary\n    svg2.attr(\n      'height',\n      (maxYCoordinate - minYCoordinate + 50) * d3.event.transform.k\n    );\n    // adjust width to compensate for verical scroll bar appearing\n    svg2.attr('width', document.getElementById('tubeMapSVG').clientWidth);\n  }\n\n  const minZoom = Math.min(\n    1,\n    document.getElementById(svgID.substring(1)).parentNode.offsetWidth /\n      (maxXCoordinate + 10)\n  );\n  zoom = d3\n    .zoom()\n    .scaleExtent([minZoom, 8])\n    .translateExtent([\n      [-1, minYCoordinate - 25],\n      [maxXCoordinate + 2, maxYCoordinate + 25]\n    ])\n    .on('zoom', zoomed);\n\n  svg = svg\n    .call(zoom)\n    .on('dblclick.zoom', null)\n    .append('g');\n\n  // translate to correct position on initial draw\n  const containerWidth = document.getElementById(svgID.substring(1)).parentNode\n    .offsetWidth;\n  const xOffset =\n    maxXCoordinate + 10 < containerWidth\n      ? (containerWidth - maxXCoordinate - 10) / 2\n      : 0;\n  d3.select(svgID).call(\n    zoom.transform,\n    d3.zoomIdentity.translate(xOffset, 25 - minYCoordinate)\n  );\n}\n\nexport function zoomBy(zoomFactor) {\n  const minZoom = Math.min(\n    1,\n    document.getElementById(svgID.substring(1)).parentNode.offsetWidth /\n      (maxXCoordinate + 10)\n  );\n  const maxZoom = 8;\n  const width = document.getElementById(svgID.substring(1)).parentElement\n    .clientWidth;\n\n  const transform = d3.zoomTransform(d3.select(svgID).node());\n  const translateK = Math.min(\n    maxZoom,\n    Math.max(transform.k * zoomFactor, minZoom)\n  );\n  let translateX =\n    width / 2.0 - ((width / 2.0 - transform.x) * translateK) / transform.k;\n  translateX = Math.min(translateX, 1 * translateK);\n  translateX = Math.max(translateX, width - (maxXCoordinate + 2) * translateK);\n  const translateY = (25 - minYCoordinate) * translateK;\n  d3.select(svgID)\n    .transition()\n    .duration(750)\n    .call(\n      zoom.transform,\n      d3.zoomIdentity.translate(translateX, translateY).scale(translateK)\n    );\n}\n\n// map node names to node indices\nfunction generateNodeMap() {\n  nodeMap = new Map();\n  nodes.forEach((node, index) => {\n    nodeMap.set(node.name, index);\n  });\n  return nodeMap;\n}\n\n// adds a successor-array to each node containing the indices of the nodes coming directly after the current node\nfunction generateNodeSuccessors() {\n  let current;\n  let follower;\n\n  nodes.forEach(node => {\n    node.successors = [];\n    node.predecessors = [];\n  });\n\n  tracks.forEach(track => {\n    for (let i = 0; i < track.indexSequence.length - 1; i += 1) {\n      current = Math.abs(track.indexSequence[i]);\n      follower = Math.abs(track.indexSequence[i + 1]);\n      if (nodes[current].successors.indexOf(follower) === -1) {\n        nodes[current].successors.push(follower);\n      }\n      if (nodes[follower].predecessors.indexOf(current) === -1) {\n        nodes[follower].predecessors.push(current);\n      }\n    }\n  });\n\n  if (reads && config.showReads) {\n    reads.forEach(track => {\n      for (let i = 0; i < track.indexSequence.length - 1; i += 1) {\n        current = Math.abs(track.indexSequence[i]);\n        follower = Math.abs(track.indexSequence[i + 1]);\n        if (nodes[current].successors.indexOf(follower) === -1) {\n          nodes[current].successors.push(follower);\n        }\n        if (nodes[follower].predecessors.indexOf(current) === -1) {\n          nodes[follower].predecessors.push(current);\n        }\n      }\n    });\n  }\n}\n\nfunction generateNodeOrderOfSingleTrack(sequence) {\n  let forwardOrder = 0;\n  let backwardOrder = 0;\n  let currentNode;\n  let minOrder = 0;\n\n  sequence.forEach(nodeIndex => {\n    if (nodeIndex < 0) {\n      currentNode = nodes[Math.abs(nodeIndex)];\n      if (!currentNode.hasOwnProperty('order')) {\n        currentNode.order = backwardOrder;\n      }\n      if (currentNode.order < minOrder) minOrder = currentNode.order;\n      forwardOrder = currentNode.order;\n      backwardOrder = currentNode.order - 1;\n    } else {\n      currentNode = nodes[nodeIndex];\n      if (!currentNode.hasOwnProperty('order')) {\n        currentNode.order = forwardOrder;\n      }\n      forwardOrder = currentNode.order + 1;\n      backwardOrder = currentNode.order;\n    }\n  });\n  if (minOrder < 0) {\n    increaseOrderForAllNodes(-minOrder);\n  }\n}\n\n// calculate the order-value of nodes contained in sequence which are to the left of the first node which already has an order-value\nfunction generateNodeOrderTrackBeginning(sequence) {\n  let anchorIndex = 0;\n  let currentOrder;\n  let currentNode;\n  let minOrder = 0;\n  let increment;\n\n  while (\n    anchorIndex < sequence.length &&\n    !nodes[Math.abs(sequence[anchorIndex])].hasOwnProperty('order')\n  ) {\n    anchorIndex += 1; // anchor = first node in common with existing graph\n  }\n  if (anchorIndex >= sequence.length) {\n    return null;\n  }\n\n  if (sequence[anchorIndex] >= 0) {\n    // regular node\n    currentOrder = nodes[sequence[anchorIndex]].order - 1;\n    increment = -1;\n  } else {\n    // reverse node\n    currentOrder = nodes[-sequence[anchorIndex]].order + 1;\n    increment = 1;\n  }\n\n  for (let j = anchorIndex - 1; j >= 0; j -= 1) {\n    // assign order to nodes which are left of anchor node\n    currentNode = nodes[Math.abs(sequence[j])];\n    if (!currentNode.hasOwnProperty('order')) {\n      currentNode.order = currentOrder;\n      minOrder = Math.min(minOrder, currentOrder);\n      currentOrder += increment;\n    }\n  }\n\n  if (minOrder < 0) {\n    increaseOrderForAllNodes(-minOrder);\n  }\n  return anchorIndex;\n}\n\n// generate global sequence of nodes from left to right, starting with first track and adding other tracks sequentially\nfunction generateNodeOrder() {\n  let modifiedSequence;\n  let currentOrder;\n  let currentNode;\n  let rightIndex;\n  let leftIndex;\n  let minOrder = 0;\n  let tracksAndReads;\n  if (reads && config.showReads) tracksAndReads = tracks.concat(reads);\n  else tracksAndReads = tracks;\n\n  nodes.forEach(node => {\n    delete node.order;\n  });\n\n  generateNodeOrderOfSingleTrack(tracks[0].indexSequence); // calculate order values for all nodes of the first track\n\n  for (let i = 1; i < tracksAndReads.length; i += 1) {\n    if (DEBUG) console.log(`generating order for track ${i + 1}`);\n    rightIndex = generateNodeOrderTrackBeginning(\n      tracksAndReads[i].indexSequence\n    ); // calculate order values for all nodes until the first anchor\n    if (rightIndex === null) {\n      if (tracksAndReads[i].type === 'haplo') {\n        generateNodeOrderOfSingleTrack(tracksAndReads[i].indexSequence);\n      } else {\n        tracksAndReads.splice(i, 1);\n        reads.splice(i - tracks.length, 1);\n        i -= 1;\n      }\n      continue;\n    }\n    modifiedSequence = uninvert(tracksAndReads[i].indexSequence);\n\n    while (rightIndex < modifiedSequence.length) {\n      // move right until the end of the sequence\n      // find next anchor node\n      leftIndex = rightIndex;\n      rightIndex += 1;\n      while (\n        rightIndex < modifiedSequence.length &&\n        !nodes[modifiedSequence[rightIndex]].hasOwnProperty('order')\n      ) {\n        rightIndex += 1;\n      }\n\n      if (rightIndex < modifiedSequence.length) {\n        // middle segment between two anchors\n        currentOrder = nodes[modifiedSequence[leftIndex]].order + 1; // start with order value of leftAnchor + 1\n        for (let j = leftIndex + 1; j < rightIndex; j += 1) {\n          nodes[modifiedSequence[j]].order = currentOrder; // assign order values\n          currentOrder += 1;\n        }\n\n        if (\n          nodes[modifiedSequence[rightIndex]].order >\n          nodes[modifiedSequence[leftIndex]].order\n        ) {\n          // if order-value of left anchor < order-value of right anchor\n          if (nodes[modifiedSequence[rightIndex]].order < currentOrder) {\n            // and the right anchor now has a lower order-value than our newly added nodes\n            increaseOrderForSuccessors(\n              modifiedSequence[rightIndex],\n              modifiedSequence[rightIndex - 1],\n              currentOrder\n            );\n          }\n        } else {\n          // potential node reversal: check for ordering conflict, if no conflict found move node at rightIndex further to the right in order to not create a track reversal\n          if (\n            tracksAndReads[i].indexSequence[rightIndex] >= 0 &&\n            !isSuccessor(\n              modifiedSequence[rightIndex],\n              modifiedSequence[leftIndex]\n            )\n          ) {\n            // no real reversal\n            increaseOrderForSuccessors(\n              modifiedSequence[rightIndex],\n              modifiedSequence[rightIndex - 1],\n              currentOrder\n            );\n          } else {\n            // real reversal\n            if (\n              tracksAndReads[i].sequence[leftIndex] < 0 ||\n              (nodes[modifiedSequence[leftIndex + 1]].degree < 2 &&\n                nodes[modifiedSequence[rightIndex]].order <\n                  nodes[modifiedSequence[leftIndex]].order)\n            ) {\n              currentOrder = nodes[modifiedSequence[leftIndex]].order - 1; // start with order value of leftAnchor - 1\n              for (let j = leftIndex + 1; j < rightIndex; j += 1) {\n                nodes[modifiedSequence[j]].order = currentOrder; // assign order values\n                currentOrder -= 1;\n              }\n            }\n          }\n        }\n      } else {\n        // right segment to the right of last anchor\n        if (tracksAndReads[i].sequence[leftIndex] >= 0) {\n          // elongate towards the right\n          currentOrder = nodes[modifiedSequence[leftIndex]].order + 1;\n          for (let j = leftIndex + 1; j < modifiedSequence.length; j += 1) {\n            currentNode = nodes[modifiedSequence[j]];\n            if (!currentNode.hasOwnProperty('order')) {\n              currentNode.order = currentOrder;\n              currentOrder += 1;\n            }\n          }\n        } else {\n          // elongate towards the left\n          currentOrder = nodes[modifiedSequence[leftIndex]].order - 1;\n          for (let j = leftIndex + 1; j < modifiedSequence.length; j += 1) {\n            currentNode = nodes[modifiedSequence[j]];\n            if (!currentNode.hasOwnProperty('order')) {\n              currentNode.order = currentOrder;\n              minOrder = Math.min(minOrder, currentOrder);\n              currentOrder -= 1;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  // adjust all nodes if necessary, so that no order<0\n  if (minOrder < 0) increaseOrderForAllNodes(-minOrder);\n}\n\nfunction isSuccessor(first, second) {\n  const visited = new Array(numberOfNodes).fill(false);\n  const stack = [];\n  stack.push(first);\n  visited[first] = true;\n  while (stack.length > 0) {\n    const current = stack.pop();\n    if (current === second) return true;\n    for (let i = 0; i < nodes[current].successors.length; i += 1) {\n      const childIndex = nodes[current].successors[i];\n      if (!visited[childIndex]) {\n        visited[childIndex] = true;\n        stack.push(childIndex);\n      }\n    }\n  }\n  return false;\n}\n\n// get order number of the rightmost node\nfunction getMaxOrder() {\n  let max = -1;\n  nodes.forEach(node => {\n    if (node.hasOwnProperty('order') && node.order > max) max = node.order;\n  });\n  return max;\n}\n\n// generates sequence keeping the order but switching all reversed (negative) nodes to forward nodes\nfunction uninvert(sequence) {\n  const result = [];\n  for (let i = 0; i < sequence.length; i += 1) {\n    if (sequence[i] >= 0) {\n      result.push(sequence[i]);\n    } else {\n      result.push(-sequence[i]);\n    }\n  }\n  return result;\n}\n\n// increases the order-value of all nodes by amount\nfunction increaseOrderForAllNodes(amount) {\n  nodes.forEach(node => {\n    if (node.hasOwnProperty('order')) node.order += amount;\n  });\n}\n\n// increases the order-value for currentNode and (if necessary) successor nodes recursively\nfunction increaseOrderForSuccessors(startingNode, tabuNode, newOrder) {\n  const increasedOrders = new Map();\n  const queue = [];\n  queue.push([startingNode, newOrder]);\n\n  while (queue.length > 0) {\n    const current = queue.shift();\n    const currentNode = current[0];\n    const currentOrder = current[1];\n\n    if (\n      nodes[currentNode].hasOwnProperty('order') &&\n      nodes[currentNode].order < currentOrder\n    ) {\n      if (\n        !increasedOrders.has(currentNode) ||\n        increasedOrders.get(currentNode) < currentOrder\n      ) {\n        increasedOrders.set(currentNode, currentOrder);\n        nodes[currentNode].successors.forEach(successor => {\n          if (\n            nodes[successor].order > nodes[currentNode].order &&\n            successor !== tabuNode\n          ) {\n            // only increase order of successors if they lie to the right of the currentNode (not for repeats/translocations)\n            queue.push([successor, currentOrder + 1]);\n          }\n        });\n        if (currentNode !== startingNode) {\n          nodes[currentNode].predecessors.forEach(predecessor => {\n            if (\n              nodes[predecessor].order > currentNode.order &&\n              predecessor !== tabuNode\n            ) {\n              // only increase order of predecessors if they lie to the right of the currentNode (not for repeats/translocations)\n              queue.push([predecessor, currentOrder + 1]);\n            }\n          });\n        }\n      }\n    }\n  }\n\n  increasedOrders.forEach((value, key) => {\n    nodes[key].order = value;\n  });\n}\n\n// calculates the node degree: the number of tracks passing through the node / the node height\nfunction generateNodeDegree() {\n  nodes.forEach(node => {\n    node.tracks = [];\n  });\n\n  tracks.forEach(track => {\n    track.indexSequence.forEach(nodeIndex => {\n      nodes[Math.abs(nodeIndex)].tracks.push(track.id);\n    });\n  });\n\n  nodes.forEach(node => {\n    if (node.hasOwnProperty('tracks')) node.degree = node.tracks.length;\n  });\n}\n\n// if more tracks pass through a specific node in reverse direction than in\n// regular direction, switch its orientation\n// (does not apply to the first track's nodes, these are always oriented as\n// dictated by the first track)\nfunction switchNodeOrientation() {\n  const toSwitch = new Map();\n  let nodeName;\n  let prevNode;\n  let nextNode;\n  let currentNode;\n\n  for (let i = 1; i < tracks.length; i += 1) {\n    for (let j = 0; j < tracks[i].sequence.length; j += 1) {\n      nodeName = tracks[i].sequence[j];\n      if (nodeName.charAt(0) === '-') nodeName = nodeName.substr(1);\n      currentNode = nodes[nodeMap.get(nodeName)];\n      if (tracks[0].sequence.indexOf(nodeName) === -1) {\n        // do not change orientation for nodes which are part of the pivot track\n        if (j > 0) {\n          if (tracks[i].sequence[j - 1].charAt(0) !== '-') {\n            prevNode = nodes[nodeMap.get(tracks[i].sequence[j - 1])];\n          } else {\n            prevNode = nodes[nodeMap.get(tracks[i].sequence[j - 1].substr(1))];\n          }\n        }\n        if (j < tracks[i].sequence.length - 1) {\n          if (tracks[i].sequence[j + 1].charAt(0) !== '-') {\n            nextNode = nodes[nodeMap.get(tracks[i].sequence[j + 1])];\n          } else {\n            nextNode = nodes[nodeMap.get(tracks[i].sequence[j + 1].substr(1))];\n          }\n        }\n        if (\n          (j === 0 || prevNode.order < currentNode.order) &&\n          (j === tracks[i].sequence.length - 1 ||\n            currentNode.order < nextNode.order)\n        ) {\n          if (!toSwitch.has(nodeName)) toSwitch.set(nodeName, 0);\n          if (tracks[i].sequence[j].charAt(0) === '-') {\n            toSwitch.set(nodeName, toSwitch.get(nodeName) + 1);\n          } else {\n            toSwitch.set(nodeName, toSwitch.get(nodeName) - 1);\n          }\n        }\n        if (\n          (j === 0 || prevNode.order > currentNode.order) &&\n          (j === tracks[i].sequence.length - 1 ||\n            currentNode.order > nextNode.order)\n        ) {\n          if (!toSwitch.has(nodeName)) toSwitch.set(nodeName, 0);\n          if (tracks[i].sequence[j].charAt(0) === '-') {\n            toSwitch.set(nodeName, toSwitch.get(nodeName) - 1);\n          } else {\n            toSwitch.set(nodeName, toSwitch.get(nodeName) + 1);\n          }\n        }\n      }\n    }\n  }\n\n  tracks.forEach((track, trackIndex) => {\n    track.sequence.forEach((node, nodeIndex) => {\n      nodeName = node;\n      if (nodeName.charAt(0) === '-') nodeName = nodeName.substr(1);\n      if (toSwitch.has(nodeName) && toSwitch.get(nodeName) > 0) {\n        if (node.charAt(0) === '-') {\n          tracks[trackIndex].sequence[nodeIndex] = node.substr(1);\n        } else {\n          tracks[trackIndex].sequence[nodeIndex] = `-${node}`;\n        }\n      }\n    });\n  });\n\n  // invert the sequence within the nodes\n  toSwitch.forEach((value, key) => {\n    if (value > 0) {\n      currentNode = nodeMap.get(key);\n      nodes[currentNode].seq = nodes[currentNode].seq\n        .split('')\n        .reverse()\n        .join('');\n    }\n  });\n}\n\n// calculates the concrete values for the nodes' x-coordinates\nfunction generateNodeXCoords() {\n  let currentX = 0;\n  let nextX = 20;\n  let currentOrder = -1;\n  const sortedNodes = nodes.slice();\n  sortedNodes.sort(compareNodesByOrder);\n  const extra = calculateExtraSpace();\n\n  sortedNodes.forEach(node => {\n    if (node.hasOwnProperty('order')) {\n      if (node.order > currentOrder) {\n        currentOrder = node.order;\n        currentX = nextX + 10 * extra[node.order];\n      }\n      node.x = currentX;\n      nextX = Math.max(nextX, currentX + 40 + node.pixelWidth);\n    }\n  });\n}\n\n// calculates additional horizontal space needed between two nodes\n// two neighboring nodes have to be moved further apart if there is a lot going on in between them\n// -> edges turning to vertical orientation should not overlap\nfunction calculateExtraSpace() {\n  const leftSideEdges = [];\n  const rightSideEdges = [];\n  const extra = [];\n\n  for (let i = 0; i <= maxOrder; i += 1) {\n    leftSideEdges.push(0);\n    rightSideEdges.push(0);\n  }\n\n  tracks.forEach(track => {\n    for (let i = 1; i < track.path.length; i += 1) {\n      if (track.path[i].order === track.path[i - 1].order) {\n        // repeat or translocation\n        if (track.path[i].isForward === true) {\n          leftSideEdges[track.path[i].order] += 1;\n        } else {\n          rightSideEdges[track.path[i].order] += 1;\n        }\n      }\n    }\n  });\n\n  extra.push(Math.max(0, leftSideEdges[0] - 1));\n  for (let i = 1; i <= maxOrder; i += 1) {\n    extra.push(\n      Math.max(0, leftSideEdges[i] - 1) + Math.max(0, rightSideEdges[i - 1] - 1)\n    );\n  }\n  return extra;\n}\n\n// create and fill assignment-variable, which contains info about tracks and lanes for each order-value\nfunction generateLaneAssignment() {\n  let segmentNumber;\n  let currentNodeIndex;\n  let currentNodeIsForward;\n  let currentNode;\n  let previousNode;\n  let previousNodeIsForward;\n  const prevSegmentPerOrderPerTrack = [];\n  const isPositive = n => ((n = +n) || 1 / n) >= 0;\n\n  // create empty variables\n  for (let i = 0; i <= maxOrder; i += 1) {\n    assignments[i] = [];\n    prevSegmentPerOrderPerTrack[i] = [];\n    for (let j = 0; j < numberOfTracks; j += 1) {\n      prevSegmentPerOrderPerTrack[i][j] = null;\n    }\n  }\n\n  tracks.forEach((track, trackNo) => {\n    // add info for start of track\n    currentNodeIndex = Math.abs(track.indexSequence[0]);\n    currentNodeIsForward = isPositive(track.indexSequence[0]);\n    currentNode = nodes[currentNodeIndex];\n\n    track.path = [];\n    track.path.push({\n      order: currentNode.order,\n      lane: null,\n      isForward: currentNodeIsForward,\n      node: currentNodeIndex\n    });\n    addToAssignment(\n      currentNode.order,\n      currentNodeIndex,\n      trackNo,\n      0,\n      prevSegmentPerOrderPerTrack\n    );\n\n    segmentNumber = 1;\n    for (let i = 1; i < track.sequence.length; i += 1) {\n      previousNode = currentNode;\n      previousNodeIsForward = currentNodeIsForward;\n\n      currentNodeIndex = Math.abs(track.indexSequence[i]);\n      currentNodeIsForward = isPositive(track.indexSequence[i]);\n      currentNode = nodes[currentNodeIndex];\n\n      if (currentNode.order > previousNode.order) {\n        if (!previousNodeIsForward) {\n          // backward to forward at previous node\n          track.path.push({\n            order: previousNode.order,\n            lane: null,\n            isForward: true,\n            node: null\n          });\n          addToAssignment(\n            previousNode.order,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n        for (let j = previousNode.order + 1; j < currentNode.order; j += 1) {\n          // forward without nodes\n          track.path.push({\n            order: j,\n            lane: null,\n            isForward: true,\n            node: null\n          });\n          addToAssignment(\n            j,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n        if (!currentNodeIsForward) {\n          // forward to backward at current node\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: true,\n            node: null\n          });\n          addToAssignment(\n            currentNode.order,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: false,\n            node: currentNodeIndex\n          });\n          addToAssignment(\n            currentNode.order,\n            currentNodeIndex,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        } else {\n          // current Node forward\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: true,\n            node: currentNodeIndex\n          });\n          addToAssignment(\n            currentNode.order,\n            currentNodeIndex,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n      } else if (currentNode.order < previousNode.order) {\n        if (previousNodeIsForward) {\n          // turnaround from fw to bw at previous node\n          track.path.push({\n            order: previousNode.order,\n            lane: null,\n            isForward: false,\n            node: null\n          });\n          addToAssignment(\n            previousNode.order,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n        for (let j = previousNode.order - 1; j > currentNode.order; j -= 1) {\n          // bachward without nodes\n          track.path.push({\n            order: j,\n            lane: null,\n            isForward: false,\n            node: null\n          });\n          addToAssignment(\n            j,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n        if (currentNodeIsForward) {\n          // backward to forward at current node\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: false,\n            node: null\n          });\n          addToAssignment(\n            currentNode.order,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: true,\n            node: currentNodeIndex\n          });\n          addToAssignment(\n            currentNode.order,\n            currentNodeIndex,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        } else {\n          // backward at current node\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: false,\n            node: currentNodeIndex\n          });\n          addToAssignment(\n            currentNode.order,\n            currentNodeIndex,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n      } else {\n        if (currentNodeIsForward !== previousNodeIsForward) {\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: currentNodeIsForward,\n            node: currentNodeIndex\n          });\n          addToAssignment(\n            currentNode.order,\n            currentNodeIndex,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        } else {\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: !currentNodeIsForward,\n            node: null\n          });\n          addToAssignment(\n            currentNode.order,\n            null,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n          track.path.push({\n            order: currentNode.order,\n            lane: null,\n            isForward: currentNodeIsForward,\n            node: currentNodeIndex\n          });\n          addToAssignment(\n            currentNode.order,\n            currentNodeIndex,\n            trackNo,\n            segmentNumber,\n            prevSegmentPerOrderPerTrack\n          );\n          segmentNumber += 1;\n        }\n      }\n    }\n  });\n\n  for (let i = 0; i <= maxOrder; i += 1) {\n    generateSingleLaneAssignment(assignments[i], i); // this is where the lanes get assigned\n  }\n}\n\nfunction addToAssignment(\n  order,\n  nodeIndex,\n  trackNo,\n  segmentID,\n  prevSegmentPerOrderPerTrack\n) {\n  const compareToFromSame = prevSegmentPerOrderPerTrack[order][trackNo];\n\n  if (nodeIndex === null) {\n    assignments[order].push({\n      type: 'single',\n      node: null,\n      tracks: [{ trackID: trackNo, segmentID, compareToFromSame }]\n    });\n    prevSegmentPerOrderPerTrack[order][trackNo] =\n      assignments[order][assignments[order].length - 1].tracks[0];\n  } else {\n    for (let i = 0; i < assignments[order].length; i += 1) {\n      if (assignments[order][i].node === nodeIndex) {\n        // add to existing node in assignment\n        assignments[order][i].type = 'multiple';\n        assignments[order][i].tracks.push({\n          trackID: trackNo,\n          segmentID,\n          compareToFromSame\n        });\n        prevSegmentPerOrderPerTrack[order][trackNo] =\n          assignments[order][i].tracks[assignments[order][i].tracks.length - 1];\n        return;\n      }\n    }\n    // create new node in assignment\n    assignments[order].push({\n      type: 'single',\n      node: nodeIndex,\n      tracks: [{ trackID: trackNo, segmentID, compareToFromSame }]\n    });\n    prevSegmentPerOrderPerTrack[order][trackNo] =\n      assignments[order][assignments[order].length - 1].tracks[0];\n  }\n}\n\n// looks at assignment and sets idealY and idealLane by looking at where the tracks come from\nfunction getIdealLanesAndCoords(assignment, order) {\n  let index;\n\n  assignment.forEach(node => {\n    node.idealLane = 0;\n    node.tracks.forEach(track => {\n      if (track.segmentID === 0) {\n        track.idealLane = track.trackID;\n        track.idealY = null;\n      } else {\n        if (\n          tracks[track.trackID].path[track.segmentID - 1].order ===\n          order - 1\n        ) {\n          track.idealLane =\n            tracks[track.trackID].path[track.segmentID - 1].lane;\n          track.idealY = tracks[track.trackID].path[track.segmentID - 1].y;\n        } else if (\n          track.segmentID < tracks[track.trackID].path.length - 1 &&\n          tracks[track.trackID].path[track.segmentID + 1].order === order - 1\n        ) {\n          track.idealLane =\n            tracks[track.trackID].path[track.segmentID + 1].lane;\n          track.idealY = tracks[track.trackID].path[track.segmentID + 1].y;\n        } else {\n          index = track.segmentID - 1;\n          while (\n            index >= 0 &&\n            tracks[track.trackID].path[index].order !== order - 1\n          ) {\n            index -= 1;\n          }\n          if (index < 0) {\n            track.idealLane = track.trackID;\n            track.idealY = null;\n          } else {\n            track.idealLane = tracks[track.trackID].path[index].lane;\n            track.idealY = tracks[track.trackID].path[index].y;\n          }\n        }\n      }\n      node.idealLane += track.idealLane;\n    });\n    node.idealLane /= node.tracks.length;\n  });\n}\n\n// assigns the optimal lanes for a single horizontal position (=order)\n// first an ideal lane is calculated for each track (which is ~ the lane of its predecessor)\n// then the nodes are sorted by their average ideal lane\n// and the whole construct is then moved up or down if necessary\nfunction generateSingleLaneAssignment(assignment, order) {\n  let currentLane = 0;\n  const potentialAdjustmentValues = new Set();\n  let currentY = 20;\n  let prevNameIsNull = false;\n  let prevTrack = -1;\n\n  getIdealLanesAndCoords(assignment, order);\n  assignment.sort(compareByIdealLane);\n\n  assignment.forEach(node => {\n    if (node.node !== null) {\n      nodes[node.node].topLane = currentLane;\n      if (prevNameIsNull) currentY -= 10;\n      nodes[node.node].y = currentY;\n      nodes[node.node].contentHeight = 0;\n      prevNameIsNull = false;\n    } else {\n      if (prevNameIsNull) currentY -= 25;\n      else if (currentY > 20) currentY -= 10;\n      prevNameIsNull = true;\n    }\n\n    node.tracks.sort(compareByIdealLane);\n    node.tracks.forEach(track => {\n      track.lane = currentLane;\n      if (track.trackID === prevTrack && node.node === null && prevNameIsNull) {\n        currentY += 10;\n      }\n      tracks[track.trackID].path[track.segmentID].lane = currentLane;\n      tracks[track.trackID].path[track.segmentID].y = currentY;\n      if (track.idealY !== null) {\n        potentialAdjustmentValues.add(track.idealY - currentY);\n      }\n      currentLane += 1;\n      currentY += tracks[track.trackID].width;\n      if (node.node !== null) {\n        nodes[node.node].contentHeight += tracks[track.trackID].width;\n      }\n      prevTrack = track.trackID;\n    });\n    currentY += 25;\n  });\n\n  adjustVertically(assignment, potentialAdjustmentValues);\n}\n\n// moves all tracks at a single horizontal location (=order) up/down to minimize lane changes\nfunction adjustVertically(assignment, potentialAdjustmentValues) {\n  let verticalAdjustment = 0;\n  let minAdjustmentCost = Number.MAX_SAFE_INTEGER;\n\n  potentialAdjustmentValues.forEach(moveBy => {\n    if (getVerticalAdjustmentCost(assignment, moveBy) < minAdjustmentCost) {\n      minAdjustmentCost = getVerticalAdjustmentCost(assignment, moveBy);\n      verticalAdjustment = moveBy;\n    }\n  });\n\n  assignment.forEach(node => {\n    if (node.node !== null) {\n      nodes[node.node].y += verticalAdjustment;\n    }\n    node.tracks.forEach(track => {\n      tracks[track.trackID].path[track.segmentID].y += verticalAdjustment;\n    });\n  });\n}\n\nfunction adjustVertically3(node, adjustBy) {\n  if (node.hasOwnProperty('order')) {\n    assignments[node.order].forEach(assignmentNode => {\n      if (assignmentNode.node !== null) {\n        const aNode = nodes[assignmentNode.node];\n        if (aNode !== node && aNode.y > node.y) {\n          aNode.y += adjustBy;\n          assignmentNode.tracks.forEach(track => {\n            tracks[track.trackID].path[track.segmentID].y += adjustBy;\n          });\n        }\n      } else {\n        // track-segment not within a node\n        assignmentNode.tracks.forEach(track => {\n          if (tracks[track.trackID].path[track.segmentID].y >= node.y) {\n            tracks[track.trackID].path[track.segmentID].y += adjustBy;\n          }\n        });\n      }\n    });\n    if (nodesPerOrder[node.order].length > 0) {\n      nodesPerOrder[node.order].forEach(nodeIndex => {\n        if (nodes[nodeIndex] !== node && nodes[nodeIndex].y > node.y) {\n          nodes[nodeIndex].y += adjustBy;\n        }\n      });\n    }\n  }\n}\n\n// calculates cost of vertical adjustment as vertical distance * width of track\nfunction getVerticalAdjustmentCost(assignment, moveBy) {\n  let result = 0;\n  assignment.forEach(node => {\n    node.tracks.forEach(track => {\n      if (track.idealY !== null && tracks[track.trackID].type !== 'read') {\n        result +=\n          Math.abs(\n            track.idealY -\n              moveBy -\n              tracks[track.trackID].path[track.segmentID].y\n          ) * tracks[track.trackID].width;\n      }\n    });\n  });\n  return result;\n}\n\nfunction compareByIdealLane(a, b) {\n  if (a.hasOwnProperty('idealLane')) {\n    if (b.hasOwnProperty('idealLane')) {\n      if (a.idealLane < b.idealLane) return -1;\n      else if (a.idealLane > b.idealLane) return 1;\n      return 0;\n    }\n    return -1;\n  }\n  if (b.hasOwnProperty('idealLane')) {\n    return 1;\n  }\n  return 0;\n}\n\nfunction compareNodesByOrder(a, b) {\n  if (a === null) {\n    if (b === null) return 0;\n    return -1;\n  }\n  if (b === null) return 1;\n\n  if (a.hasOwnProperty('order')) {\n    if (b.hasOwnProperty('order')) {\n      if (a.order < b.order) return -1;\n      else if (a.order > b.order) return 1;\n      if (a.hasOwnProperty('y') && b.hasOwnProperty('y')) {\n        if (a.y < b.y) return -1;\n        else if (a.y > b.y) return 1;\n      }\n      return 0;\n    }\n    return -1;\n  }\n  if (b.hasOwnProperty('order')) return 1;\n  return 0;\n}\n\nfunction addTrackFeatures() {\n  let nodeStart;\n  let nodeEnd;\n  let feature = {};\n\n  bed.forEach(line => {\n    let i = 0;\n    while (i < numberOfTracks && tracks[i].name !== line.track) i += 1;\n    if (i < numberOfTracks) {\n      nodeStart = 0;\n      tracks[i].path.forEach(node => {\n        if (node.node !== null) {\n          feature = {};\n          if (nodes[node.node].hasOwnProperty('sequenceLength')) {\n            nodeEnd = nodeStart + nodes[node.node].sequenceLength - 1;\n          } else {\n            nodeEnd = nodeStart + nodes[node.node].width - 1;\n          }\n\n          if (nodeStart >= line.start && nodeStart <= line.end) {\n            feature.start = 0;\n          }\n          if (nodeStart < line.start && nodeEnd >= line.start) {\n            feature.start = line.start - nodeStart;\n          }\n          if (nodeEnd <= line.end && nodeEnd >= line.start) {\n            feature.end = nodeEnd - nodeStart;\n            if (nodeEnd < line.end) feature.continue = true;\n          }\n          if (nodeEnd > line.end && nodeStart <= line.end) {\n            feature.end = line.end - nodeStart;\n          }\n          if (feature.hasOwnProperty('start')) {\n            feature.type = line.type;\n            feature.name = line.name;\n            if (!node.hasOwnProperty('features')) node.features = [];\n            node.features.push(feature);\n          }\n          nodeStart = nodeEnd + 1;\n        }\n      });\n    }\n  });\n}\n\nfunction calculateTrackWidth() {\n  // flag: if vg returns freq of 0 for all tracks, we will increase width manually\n  let allAreFour = true;\n\n  tracks.forEach(track => {\n    if (track.hasOwnProperty('freq')) {\n      // custom track width\n      track.width = Math.round((Math.log(track.freq) + 1) * 4);\n    } else {\n      // default track width\n      track.width = 15;\n      if (track.hasOwnProperty('type') && track.type === 'read') {\n        track.width = 4;\n      }\n    }\n    if (track.width !== 4) {\n      allAreFour = false;\n    }\n  });\n\n  if (allAreFour) {\n    tracks.forEach(track => {\n      if (track.hasOwnProperty('freq')) {\n        track.width = 15;\n      }\n    });\n  }\n}\n\nexport function useColorScheme(x) {\n  config.colorScheme = x;\n  svg = d3.select(svgID);\n  const tr = createTubeMap();\n  if (!config.hideLegendFlag) drawLegend(tr);\n}\n\nfunction assignColorSets() {\n  haplotypeColors = getColorSet(config.haplotypeColors);\n  forwardReadColors = getColorSet(config.forwardReadColors);\n  reverseReadColors = getColorSet(config.reverseReadColors);\n  exonColors = getColorSet(config.exonColors);\n}\n\nfunction getColorSet(colorSetName) {\n  switch (colorSetName) {\n    case 'plainColors':\n      return plainColors;\n    case 'reds':\n      return reds;\n    case 'blues':\n      return blues;\n    case 'greys':\n      return greys;\n    case 'lightColors':\n      return lightColors;\n    default:\n      return greys;\n  }\n}\n\nfunction generateTrackColor(track, highlight) {\n  if (typeof highlight === 'undefined') highlight = 'plain';\n  let trackColor;\n  if (track.hasOwnProperty('type') && track.type === 'read') {\n    if (config.colorReadsByMappingQuality) {\n      trackColor = d3.interpolateRdYlGn(\n        Math.min(60, track.mapping_quality) / 60\n      );\n    } else {\n      if (track.hasOwnProperty('is_reverse') && track.is_reverse === true) {\n        trackColor = reverseReadColors[track.id % reverseReadColors.length];\n      } else {\n        trackColor = forwardReadColors[track.id % forwardReadColors.length];\n      }\n    }\n  } else {\n    if (config.showExonsFlag === false || highlight !== 'plain') {\n      trackColor = haplotypeColors[track.id % haplotypeColors.length];\n    } else {\n      trackColor = exonColors[track.id % exonColors.length];\n    }\n  }\n  return trackColor;\n}\n\nfunction getReadXStart(read) {\n  const node = nodes[read.path[0].node];\n  if (read.path[0].isForward) {\n    // read starts in forward direction\n    return getXCoordinateOfBaseWithinNode(node, read.firstNodeOffset);\n  }\n  // read starts in backward direction\n  return getXCoordinateOfBaseWithinNode(\n    node,\n    node.sequenceLength - read.firstNodeOffset\n  );\n}\n\nfunction getReadXEnd(read) {\n  const node = nodes[read.path[read.path.length - 1].node];\n  if (read.path[read.path.length - 1].isForward) {\n    // read ends in forward direction\n    return getXCoordinateOfBaseWithinNode(node, read.finalNodeCoverLength);\n  }\n  // read ends in backward direction\n  return getXCoordinateOfBaseWithinNode(\n    node,\n    node.sequenceLength - read.finalNodeCoverLength\n  );\n}\n\n// returns the x coordinate (in pixels) of (the left side) of the given base\n// position within the given node\nfunction getXCoordinateOfBaseWithinNode(node, base) {\n  if (base > node.sequenceLength) return null; // equality is allowed\n  const nodeLeftX = node.x - 4;\n  const nodeRightX = node.x + node.pixelWidth + 4;\n  return nodeLeftX + (base / node.sequenceLength) * (nodeRightX - nodeLeftX);\n}\n\n// transforms the info in the tracks' path attribute into actual coordinates\n// and saves them in trackRectangles and trackCurves\nfunction generateSVGShapesFromPath() {\n  let xStart;\n  let xEnd;\n  let yStart;\n  let yEnd;\n  let trackColor;\n  let highlight;\n  let dummy;\n  let reversalFlag;\n\n  for (let i = 0; i <= maxOrder; i += 1) {\n    extraLeft.push(0);\n    extraRight.push(0);\n  }\n\n  // generate x coords where each order starts and ends\n  const orderStartX = [];\n  const orderEndX = [];\n  nodes.forEach(node => {\n    if (node.hasOwnProperty('order')) {\n      orderStartX[node.order] = node.x;\n      if (orderEndX[node.order] === undefined) {\n        orderEndX[node.order] = node.x + node.pixelWidth;\n      } else {\n        orderEndX[node.order] = Math.max(\n          orderEndX[node.order],\n          node.x + node.pixelWidth\n        );\n      }\n    }\n  });\n\n  tracks.forEach(track => {\n    highlight = 'plain';\n    trackColor = generateTrackColor(track, highlight);\n\n    // start of path\n    yStart = track.path[0].y;\n    if (track.type !== 'read') {\n      if (track.sequence[0].charAt(0) === '-') {\n        // The track starts with an inversed node\n        xStart = orderEndX[track.path[0].order] + 20;\n      } else {\n        // The track starts with a forward node\n        xStart = orderStartX[track.path[0].order] - 20;\n      }\n    } else {\n      xStart = getReadXStart(track);\n    }\n\n    // middle of path\n    for (let i = 0; i < track.path.length; i += 1) {\n      if (track.path[i].y === yStart) {\n        if (track.path[i].hasOwnProperty('features')) {\n          reversalFlag =\n            i > 0 && track.path[i - 1].order === track.path[i].order;\n          dummy = createFeatureRectangle(\n            track.path[i],\n            orderStartX[track.path[i].order],\n            orderEndX[track.path[i].order],\n            highlight,\n            track,\n            xStart,\n            yStart,\n            trackColor,\n            reversalFlag\n          );\n          highlight = dummy.highlight;\n          xStart = dummy.xStart;\n        }\n      } else {\n        if (track.path[i - 1].isForward) {\n          xEnd = orderEndX[track.path[i - 1].order];\n        } else {\n          xEnd = orderStartX[track.path[i - 1].order];\n        }\n        if (xEnd !== xStart) {\n          trackColor = generateTrackColor(track, highlight);\n          trackRectangles.push({\n            xStart: Math.min(xStart, xEnd),\n            yStart,\n            xEnd: Math.max(xStart, xEnd),\n            yEnd: yStart + track.width - 1,\n            color: trackColor,\n            id: track.id,\n            type: track.type\n          });\n        }\n\n        if (track.path[i].order - 1 === track.path[i - 1].order) {\n          // regular forward connection\n          xStart = xEnd;\n          xEnd = orderStartX[track.path[i].order];\n          yEnd = track.path[i].y;\n          trackColor = generateTrackColor(track, highlight);\n          trackCurves.push({\n            xStart,\n            yStart,\n            xEnd: xEnd + 1,\n            yEnd,\n            width: track.width,\n            color: trackColor,\n            laneChange: Math.abs(track.path[i].lane - track.path[i - 1].lane),\n            id: track.id,\n            type: track.type\n          });\n          xStart = xEnd;\n          yStart = yEnd;\n        } else if (track.path[i].order + 1 === track.path[i - 1].order) {\n          // regular backward connection\n          xStart = xEnd;\n          xEnd = orderEndX[track.path[i].order];\n          yEnd = track.path[i].y;\n          trackColor = generateTrackColor(track, highlight);\n          trackCurves.push({\n            xStart: xStart + 1,\n            yStart,\n            xEnd,\n            yEnd,\n            width: track.width,\n            color: trackColor,\n            laneChange: Math.abs(track.path[i].lane - track.path[i - 1].lane),\n            id: track.id,\n            type: track.type\n          });\n          xStart = xEnd;\n          yStart = yEnd;\n        } else {\n          // change of direction\n          if (track.path[i - 1].isForward) {\n            yEnd = track.path[i].y;\n            generateForwardToReverse(\n              xEnd,\n              yStart,\n              yEnd,\n              track.width,\n              trackColor,\n              track.id,\n              track.path[i].order,\n              track.type\n            );\n            xStart = orderEndX[track.path[i].order];\n            yStart = track.path[i].y;\n          } else {\n            yEnd = track.path[i].y;\n            generateReverseToForward(\n              xEnd,\n              yStart,\n              yEnd,\n              track.width,\n              trackColor,\n              track.id,\n              track.path[i].order,\n              track.type\n            );\n            xStart = orderStartX[track.path[i].order];\n            yStart = track.path[i].y;\n          }\n        }\n\n        if (track.path[i].hasOwnProperty('features')) {\n          reversalFlag = track.path[i - 1].order === track.path[i].order;\n          dummy = createFeatureRectangle(\n            track.path[i],\n            orderStartX[track.path[i].order],\n            orderEndX[track.path[i].order],\n            highlight,\n            track,\n            xStart,\n            yStart,\n            trackColor,\n            reversalFlag\n          );\n          highlight = dummy.highlight;\n          xStart = dummy.xStart;\n        }\n      }\n    }\n\n    // ending edges\n    if (track.type !== 'read') {\n      if (!track.path[track.path.length - 1].isForward) {\n        // The track ends with an inversed node\n        xEnd = orderStartX[track.path[track.path.length - 1].order] - 20;\n      } else {\n        // The track ends with a forward node\n        xEnd = orderEndX[track.path[track.path.length - 1].order] + 20;\n      }\n    } else {\n      xEnd = getReadXEnd(track);\n    }\n    trackRectangles.push({\n      xStart: Math.min(xStart, xEnd),\n      yStart,\n      xEnd: Math.max(xStart, xEnd),\n      yEnd: yStart + track.width - 1,\n      color: trackColor,\n      id: track.id,\n      type: track.type\n    });\n  });\n}\n\nfunction createFeatureRectangle(\n  node,\n  nodeXStart,\n  nodeXEnd,\n  highlight,\n  track,\n  rectXStart,\n  yStart,\n  trackColor,\n  reversalFlag\n) {\n  let nodeWidth;\n  let currentHighlight = highlight;\n  let c;\n  let co;\n  let featureXStart;\n  let featureXEnd;\n\n  nodeXStart -= 8;\n  nodeXEnd += 8;\n  if (nodes[node.node].hasOwnProperty('sequenceLength')) {\n    nodeWidth = nodes[node.node].sequenceLength;\n  } else {\n    nodeWidth = nodes[node.node].width;\n  }\n\n  node.features.sort((a, b) => a.start - b.start);\n  node.features.forEach(feature => {\n    if (currentHighlight !== feature.type) {\n      // finish incoming rectangle\n      c = generateTrackColor(track, currentHighlight);\n      if (node.isForward === true) {\n        featureXStart =\n          nodeXStart +\n          Math.round((feature.start * (nodeXEnd - nodeXStart + 1)) / nodeWidth);\n\n        // overwrite narrow post-inversion rectangle if highlight starts near beginning of node\n        if (reversalFlag && featureXStart < nodeXStart + 8) {\n          featureXEnd =\n            nodeXStart +\n            Math.round(\n              ((feature.end + 1) * (nodeXEnd - nodeXStart + 1)) / nodeWidth\n            ) -\n            1;\n          co = generateTrackColor(track, feature.type);\n          trackRectanglesStep3.push({\n            xStart: featureXStart,\n            yStart,\n            xEnd: featureXEnd,\n            yEnd: yStart + track.width - 1,\n            color: co,\n            id: track.id,\n            type: track.type\n          });\n        }\n\n        if (featureXStart > rectXStart + 1) {\n          trackRectanglesStep3.push({\n            xStart: rectXStart,\n            yStart,\n            xEnd: featureXStart - 1,\n            yEnd: yStart + track.width - 1,\n            color: c,\n            id: track.id,\n            type: track.type\n          });\n        }\n      } else {\n        featureXStart =\n          nodeXEnd -\n          Math.round((feature.start * (nodeXEnd - nodeXStart + 1)) / nodeWidth);\n\n        // overwrite narrow post-inversion rectangle if highlight starts near beginning of node\n        if (reversalFlag && featureXStart > nodeXEnd - 8) {\n          featureXEnd =\n            nodeXEnd -\n            Math.round(\n              ((feature.end + 1) * (nodeXEnd - nodeXStart + 1)) / nodeWidth\n            ) -\n            1;\n          co = generateTrackColor(track, feature.type);\n          trackRectanglesStep3.push({\n            xStart: featureXEnd,\n            yStart,\n            xEnd: featureXStart,\n            yEnd: yStart + track.width - 1,\n            color: co,\n            id: track.id,\n            type: track.type\n          });\n        }\n\n        if (rectXStart > featureXStart + 1) {\n          trackRectanglesStep3.push({\n            xStart: featureXStart + 1,\n            yStart,\n            xEnd: rectXStart,\n            yEnd: yStart + track.width - 1,\n            color: c,\n            id: track.id,\n            type: track.type\n          });\n        }\n      }\n      rectXStart = featureXStart;\n      currentHighlight = feature.type;\n    }\n    if (feature.end < nodeWidth - 1 || !feature.hasOwnProperty('continue')) {\n      // finish internal rectangle\n      c = generateTrackColor(track, currentHighlight);\n      if (node.isForward === true) {\n        featureXEnd =\n          nodeXStart +\n          Math.round(\n            ((feature.end + 1) * (nodeXEnd - nodeXStart + 1)) / nodeWidth\n          ) -\n          1;\n        trackRectanglesStep3.push({\n          xStart: rectXStart,\n          yStart,\n          xEnd: featureXEnd,\n          yEnd: yStart + track.width - 1,\n          color: c,\n          id: track.id,\n          type: track.type\n        });\n      } else {\n        featureXEnd =\n          nodeXEnd -\n          Math.round(\n            ((feature.end + 1) * (nodeXEnd - nodeXStart + 1)) / nodeWidth\n          ) -\n          1;\n        trackRectanglesStep3.push({\n          xStart: featureXEnd,\n          yStart,\n          xEnd: rectXStart,\n          yEnd: yStart + track.width - 1,\n          color: c,\n          id: track.id,\n          type: track.type\n        });\n      }\n      rectXStart = featureXEnd + 1;\n      currentHighlight = 'plain';\n    }\n  });\n  return { xStart: rectXStart, highlight: currentHighlight };\n}\n\nfunction generateForwardToReverse(\n  x,\n  yStart,\n  yEnd,\n  trackWidth,\n  trackColor,\n  trackID,\n  order,\n  type\n) {\n  x += 10 * extraRight[order];\n  const yTop = Math.min(yStart, yEnd);\n  const yBottom = Math.max(yStart, yEnd);\n  const radius = 7;\n\n  trackVerticalRectangles.push({\n    // elongate incoming rectangle a bit to the right\n    xStart: x - 10 * extraRight[order],\n    yStart,\n    xEnd: x + 5,\n    yEnd: yStart + trackWidth - 1,\n    color: trackColor,\n    id: trackID,\n    type\n  });\n  trackVerticalRectangles.push({\n    // vertical rectangle\n    xStart: x + 5 + radius,\n    yStart: yTop + trackWidth + radius - 1,\n    xEnd: x + 5 + radius + Math.min(7, trackWidth) - 1,\n    yEnd: yBottom - radius + 1,\n    color: trackColor,\n    id: trackID,\n    type\n  });\n  trackVerticalRectangles.push({\n    xStart: x - 10 * extraRight[order],\n    yStart: yEnd,\n    xEnd: x + 5,\n    yEnd: yEnd + trackWidth - 1,\n    color: trackColor,\n    id: trackID,\n    type\n  }); // elongate outgoing rectangle a bit to the right\n\n  let d = `M ${x + 5} ${yBottom}`;\n  d += ` Q ${x + 5 + radius} ${yBottom} ${x + 5 + radius} ${yBottom - radius}`;\n  d += ` H ${x + 5 + radius + Math.min(7, trackWidth)}`;\n  d += ` Q ${x + 5 + radius + Math.min(7, trackWidth)} ${yBottom +\n    trackWidth} ${x + 5} ${yBottom + trackWidth}`;\n  d += ' Z ';\n  trackCorners.push({ path: d, color: trackColor, id: trackID, type });\n\n  d = `M ${x + 5} ${yTop}`;\n  d += ` Q ${x + 5 + radius + Math.min(7, trackWidth)} ${yTop} ${x +\n    5 +\n    radius +\n    Math.min(7, trackWidth)} ${yTop + trackWidth + radius}`;\n  d += ` H ${x + 5 + radius}`;\n  d += ` Q ${x + 5 + radius} ${yTop + trackWidth} ${x + 5} ${yTop +\n    trackWidth}`;\n  d += ' Z ';\n  trackCorners.push({ path: d, color: trackColor, id: trackID, type });\n  extraRight[order] += 1;\n}\n\nfunction generateReverseToForward(\n  x,\n  yStart,\n  yEnd,\n  trackWidth,\n  trackColor,\n  trackID,\n  order,\n  type\n) {\n  const yTop = Math.min(yStart, yEnd);\n  const yBottom = Math.max(yStart, yEnd);\n  const radius = 7;\n  x -= 10 * extraLeft[order];\n\n  trackVerticalRectangles.push({\n    xStart: x - 6,\n    yStart,\n    xEnd: x + 10 * extraLeft[order],\n    yEnd: yStart + trackWidth - 1,\n    color: trackColor,\n    id: trackID,\n    type\n  }); // elongate incoming rectangle a bit to the left\n  trackVerticalRectangles.push({\n    xStart: x - 5 - radius - Math.min(7, trackWidth),\n    yStart: yTop + trackWidth + radius - 1,\n    xEnd: x - 5 - radius - 1,\n    yEnd: yBottom - radius + 1,\n    color: trackColor,\n    id: trackID,\n    type\n  }); // vertical rectangle\n  trackVerticalRectangles.push({\n    xStart: x - 6,\n    yStart: yEnd,\n    xEnd: x + 10 * extraLeft[order],\n    yEnd: yEnd + trackWidth - 1,\n    color: trackColor,\n    id: trackID,\n    type\n  }); // elongate outgoing rectangle a bit to the left\n\n  // Path for bottom 90 degree bend\n  let d = `M ${x - 5} ${yBottom}`;\n  d += ` Q ${x - 5 - radius} ${yBottom} ${x - 5 - radius} ${yBottom - radius}`;\n  d += ` H ${x - 5 - radius - Math.min(7, trackWidth)}`;\n  d += ` Q ${x - 5 - radius - Math.min(7, trackWidth)} ${yBottom +\n    trackWidth} ${x - 5} ${yBottom + trackWidth}`;\n  d += ' Z ';\n  trackCorners.push({ path: d, color: trackColor, id: trackID, type });\n\n  // Path for top 90 degree bend\n  d = `M ${x - 5} ${yTop}`;\n  d += ` Q ${x - 5 - radius - Math.min(7, trackWidth)} ${yTop} ${x -\n    5 -\n    radius -\n    Math.min(7, trackWidth)} ${yTop + trackWidth + radius}`;\n  d += ` H ${x - 5 - radius}`;\n  d += ` Q ${x - 5 - radius} ${yTop + trackWidth} ${x - 5} ${yTop +\n    trackWidth}`;\n  d += ' Z ';\n  trackCorners.push({ path: d, color: trackColor, id: trackID, type });\n  extraLeft[order] += 1;\n}\n\n// to avoid problems with wrong overlapping of tracks, draw them in order of their color\nfunction drawReversalsByColor(corners, rectangles, type) {\n  if (typeof type === 'undefined') type = 'haplo';\n  const co = new Set();\n  rectangles.forEach(rect => {\n    co.add(rect.color);\n  });\n  co.forEach(c => {\n    drawTrackRectangles(\n      rectangles.filter(filterObjectByAttribute('color', c)),\n      type\n    );\n    drawTrackCorners(corners.filter(filterObjectByAttribute('color', c)), type);\n  });\n}\n\n// draws nodes by building svg-path for border and filling it with transparent white\nfunction drawNodes(dNodes) {\n  let x;\n  let y;\n\n  dNodes.forEach(node => {\n    // top left arc\n    node.d = `M ${node.x - 9} ${node.y} Q ${node.x - 9} ${node.y - 9} ${\n      node.x\n    } ${node.y - 9}`;\n    x = node.x;\n    y = node.y - 9;\n\n    // top straight\n    if (node.width > 1) {\n      x += node.pixelWidth;\n      node.d += ` L ${x} ${y}`;\n    }\n\n    // top right arc\n    node.d += ` Q ${x + 9} ${y} ${x + 9} ${y + 9}`;\n    x += 9;\n    y += 9;\n\n    // right straight\n    if (node.contentHeight > 0) {\n      y += node.contentHeight - 0;\n      node.d += ` L ${x} ${y}`;\n    }\n\n    // bottom right arc\n    node.d += ` Q ${x} ${y + 9} ${x - 9} ${y + 9}`;\n    x -= 9;\n    y += 9;\n\n    // bottom straight\n    if (node.width > 1) {\n      x -= node.pixelWidth;\n      node.d += ` L ${x} ${y}`;\n    }\n\n    // bottom left arc\n    node.d += ` Q ${x - 9} ${y} ${x - 9} ${y - 9}`;\n    x -= 9;\n    y -= 9;\n\n    // left straight\n    if (node.contentHeight > 0) {\n      y -= node.contentHeight - 0;\n      node.d += ` L ${x} ${y}`;\n    }\n  });\n\n  svg\n    .selectAll('.node')\n    .data(dNodes)\n    .enter()\n    .append('path')\n    .attr('id', d => d.name)\n    .attr('d', d => d.d)\n    .on('mouseover', nodeMouseOver)\n    .on('mouseout', nodeMouseOut)\n    .on('dblclick', nodeDoubleClick)\n    .style('fill', '#fff')\n    .style('fill-opacity', config.showExonsFlag ? '0.4' : '0.6')\n    .style('stroke', 'black')\n    .style('stroke-width', '2px')\n    .append('svg:title')\n    .text(d => d.name);\n}\n\n// draw seqence labels for nodes\nfunction drawLabels(dNodes) {\n  if (config.nodeWidthOption === 0) {\n    svg\n      .selectAll('text')\n      .data(dNodes)\n      .enter()\n      .append('text')\n      .attr('x', d => d.x - 4)\n      .attr('y', d => d.y + 4)\n      .text(d => d.seq)\n      .attr('font-family', 'Courier, \"Lucida Console\", monospace')\n      .attr('font-size', '14px')\n      .attr('fill', 'black')\n      .style('pointer-events', 'none');\n  }\n}\n\nfunction drawRuler() {\n  let rulerTrackIndex = 0;\n  while (tracks[rulerTrackIndex].name !== trackForRuler) rulerTrackIndex += 1;\n  const rulerTrack = tracks[rulerTrackIndex];\n\n  // draw horizontal line\n  svg\n    .append('line')\n    .attr('x1', 0)\n    .attr('y1', minYCoordinate - 10)\n    .attr('x2', maxXCoordinate)\n    .attr('y2', minYCoordinate - 10)\n    .attr('stroke-width', 1)\n    .attr('stroke', 'black');\n\n  let markingInterval = 100;\n  if (config.nodeWidthOption === 0) markingInterval = 20;\n\n  let indexOfFirstBaseInNode = rulerTrack.indexOfFirstBase;\n  let atLeastOneMarkingDrawn = false;\n  let xCoordOfPreviousMarking = -100;\n\n  // draw ruler marking at the left end of chart for compressed charts\n  // (this marking is on purpose not at a 0 % 100 position)\n  if (config.nodeWidthOption !== 0) {\n    const firstNode = nodes[rulerTrack.indexSequence[0]];\n    xCoordOfPreviousMarking = getXCoordinateOfBaseWithinNode(firstNode, 0);\n    drawRulerMarking(indexOfFirstBaseInNode, xCoordOfPreviousMarking);\n    atLeastOneMarkingDrawn = true;\n  }\n\n  rulerTrack.indexSequence.forEach(nodeIndex => {\n    const currentNode = nodes[nodeIndex];\n    let nextMarking =\n      Math.ceil(indexOfFirstBaseInNode / markingInterval) * markingInterval;\n    while (nextMarking < indexOfFirstBaseInNode + currentNode.sequenceLength) {\n      const xCoordOfMarking = getXCoordinateOfBaseWithinNode(\n        currentNode,\n        nextMarking - indexOfFirstBaseInNode\n      );\n      if (xCoordOfPreviousMarking + 80 <= xCoordOfMarking) {\n        drawRulerMarking(nextMarking, xCoordOfMarking);\n        atLeastOneMarkingDrawn = true;\n        xCoordOfPreviousMarking = xCoordOfMarking;\n      }\n      nextMarking += markingInterval;\n    }\n    indexOfFirstBaseInNode += nodes[nodeIndex].sequenceLength;\n  });\n\n  // if no markings drawn, draw one at the very beginning\n  if (!atLeastOneMarkingDrawn) {\n    drawRulerMarking(\n      rulerTrack.indexOfFirstBase,\n      nodes[rulerTrack.indexSequence[0]].x - 4\n    );\n  }\n}\n\nfunction drawRulerMarking(sequencePosition, xCoordinate) {\n  svg\n    .append('text')\n    .attr('x', xCoordinate)\n    .attr('y', minYCoordinate - 13)\n    .text(`|${sequencePosition}`)\n    .attr('font-family', 'Courier, \"Lucida Console\", monospace')\n    .attr('font-size', '12px')\n    .attr('fill', 'black')\n    .style('pointer-events', 'none');\n}\n\nfunction filterObjectByAttribute(attribute, value) {\n  return item => item[attribute] === value;\n}\n\nfunction drawTrackRectangles(rectangles, type) {\n  if (typeof type === 'undefined') type = 'haplo';\n  rectangles = rectangles.filter(filterObjectByAttribute('type', type));\n\n  svg\n    .selectAll('trackRectangles')\n    .data(rectangles)\n    .enter()\n    .append('rect')\n    .attr('x', d => d.xStart)\n    .attr('y', d => d.yStart)\n    .attr('width', d => d.xEnd - d.xStart + 1)\n    .attr('height', d => d.yEnd - d.yStart + 1)\n    .style('fill', d => d.color)\n    .attr('trackID', d => d.id)\n    .attr('class', d => `track${d.id}`)\n    .attr('color', d => d.color)\n    .on('mouseover', trackMouseOver)\n    .on('mouseout', trackMouseOut)\n    .on('dblclick', trackDoubleClick);\n}\n\nfunction compareCurvesByLineChanges(a, b) {\n  if (a[6] < b[6]) return -1;\n  else if (a[6] > b[6]) return 1;\n  return 0;\n}\n\nfunction defineSVGPatterns() {\n  const defs = svg.append('defs');\n  let pattern = defs.append('pattern').attrs({\n    id: 'patternA',\n    width: '7',\n    height: '7',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '7', height: '7', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '3', height: '3', fill: '#505050' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '3', height: '3', fill: '#505050' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '3', height: '3', fill: '#505050' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '3', height: '3', fill: '#505050' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'patternB',\n    width: '8',\n    height: '8',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '8', height: '8', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '3', height: '3', fill: '#1f77b4' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '5', width: '3', height: '3', fill: '#1f77b4' });\n  pattern\n    .append('rect')\n    .attrs({ x: '5', y: '0', width: '3', height: '3', fill: '#1f77b4' });\n  pattern\n    .append('rect')\n    .attrs({ x: '5', y: '5', width: '3', height: '3', fill: '#1f77b4' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'plaid0',\n    width: '6',\n    height: '6',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '6', height: '6', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '2', height: '2', fill: '#1f77b4' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '2', height: '2', fill: '#1f77b4' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '2', height: '2', fill: '#1f77b4' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '2', height: '2', fill: '#1f77b4' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'plaid1',\n    width: '6',\n    height: '6',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '6', height: '6', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '2', height: '2', fill: '#ff7f0e' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '2', height: '2', fill: '#ff7f0e' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '2', height: '2', fill: '#ff7f0e' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '2', height: '2', fill: '#ff7f0e' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'plaid2',\n    width: '6',\n    height: '6',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '6', height: '6', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '2', height: '2', fill: '#2ca02c' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '2', height: '2', fill: '#2ca02c' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '2', height: '2', fill: '#2ca02c' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '2', height: '2', fill: '#2ca02c' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'plaid3',\n    width: '6',\n    height: '6',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '6', height: '6', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '2', height: '2', fill: '#d62728' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '2', height: '2', fill: '#d62728' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '2', height: '2', fill: '#d62728' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '2', height: '2', fill: '#d62728' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'plaid4',\n    width: '6',\n    height: '6',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '6', height: '6', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '2', height: '2', fill: '#9467bd' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '2', height: '2', fill: '#9467bd' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '2', height: '2', fill: '#9467bd' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '2', height: '2', fill: '#9467bd' });\n\n  pattern = defs.append('pattern').attrs({\n    id: 'plaid5',\n    width: '6',\n    height: '6',\n    patternUnits: 'userSpaceOnUse',\n    patternTransform: 'rotate(45)'\n  });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '6', height: '6', fill: '#FFFFFF' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '0', width: '2', height: '2', fill: '#8c564b' });\n  pattern\n    .append('rect')\n    .attrs({ x: '0', y: '4', width: '2', height: '2', fill: '#8c564b' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '0', width: '2', height: '2', fill: '#8c564b' });\n  pattern\n    .append('rect')\n    .attrs({ x: '4', y: '4', width: '2', height: '2', fill: '#8c564b' });\n}\n\nfunction drawTrackCurves(type) {\n  if (typeof type === 'undefined') type = 'haplo';\n  const myTrackCurves = trackCurves.filter(\n    filterObjectByAttribute('type', type)\n  );\n\n  myTrackCurves.sort(compareCurvesByLineChanges);\n\n  myTrackCurves.forEach(curve => {\n    const xMiddle = (curve.xStart + curve.xEnd) / 2;\n    let d = `M ${curve.xStart} ${curve.yStart}`;\n    d += ` C ${xMiddle} ${curve.yStart} ${xMiddle} ${curve.yEnd} ${\n      curve.xEnd\n    } ${curve.yEnd}`;\n    d += ` V ${curve.yEnd + curve.width}`;\n    d += ` C ${xMiddle} ${curve.yEnd + curve.width} ${xMiddle} ${curve.yStart +\n      curve.width} ${curve.xStart} ${curve.yStart + curve.width}`;\n    d += ' Z';\n    curve.path = d;\n  });\n\n  svg\n    .selectAll('trackCurves')\n    .data(trackCurves)\n    .enter()\n    .append('path')\n    .attr('d', d => d.path)\n    .style('fill', d => d.color)\n    .attr('trackID', d => d.id)\n    .attr('class', d => `track${d.id}`)\n    .attr('color', d => d.color)\n    .on('mouseover', trackMouseOver)\n    .on('mouseout', trackMouseOut)\n    .on('dblclick', trackDoubleClick);\n}\n\nfunction drawTrackCorners(corners, type) {\n  if (typeof type === 'undefined') type = 'haplo';\n  corners = corners.filter(filterObjectByAttribute('type', type));\n\n  svg\n    .selectAll('trackCorners')\n    .data(corners)\n    .enter()\n    .append('path')\n    .attr('d', d => d.path)\n    .style('fill', d => d.color)\n    .attr('trackID', d => d.id)\n    .attr('class', d => `track${d.id}`)\n    .attr('color', d => d.color)\n    .on('mouseover', trackMouseOver)\n    .on('mouseout', trackMouseOut)\n    .on('dblclick', trackDoubleClick);\n}\n\nfunction drawLegend() {\n  let content =\n    '<table class=\"table-sm table-condensed table-nonfluid\"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>';\n  const listeners = [];\n  for (let i = 0; i < tracks.length; i += 1) {\n    if (tracks[i].type === 'haplo') {\n      content += `<tr><td style=\"text-align:right\"><div class=\"color-box\" style=\"background-color: ${generateTrackColor(\n        tracks[i],\n        'exon'\n      )};\"></div></td>`;\n      if (tracks[i].hasOwnProperty('name')) {\n        content += `<td>${tracks[i].name}</td>`;\n      } else {\n        content += `<td>${tracks[i].id}</td>`;\n      }\n      content += `<td><input type=\"checkbox\" checked=true id=\"showTrack${i}\"></td>`;\n      listeners.push(i);\n    }\n  }\n  content += '</table';\n  // $('#legendDiv').html(content);\n  document.getElementById('legendDiv').innerHTML = content;\n  listeners.forEach(i => {\n    document\n      .getElementById(`showTrack${i}`)\n      .addEventListener('click', () => changeTrackVisibility(i), false);\n  });\n}\n\n// Highlight track on mouseover\nfunction trackMouseOver() {\n  /* jshint validthis: true */\n  const trackID = d3.select(this).attr('trackID');\n  d3.selectAll(`.track${trackID}`).style('fill', 'url(#patternA)');\n}\n\n// Highlight node on mouseover\nfunction nodeMouseOver() {\n  /* jshint validthis: true */\n  d3.select(this).style('stroke-width', '4px');\n}\n\n// Restore original track appearance on mouseout\nfunction trackMouseOut() {\n  /* jshint validthis: true */\n  const trackID = d3.select(this).attr('trackID');\n  d3.selectAll(`.track${trackID}`).each(function clearTrackHighlight() {\n    const c = d3.select(this).attr('color');\n    d3.select(this).style('fill', c);\n  });\n}\n\n// Restore original node appearance on mouseout\nfunction nodeMouseOut() {\n  /* jshint validthis: true */\n  d3.select(this).style('stroke-width', '2px');\n}\n\n// Move clicked track to first position\nfunction trackDoubleClick() {\n  /* jshint validthis: true */\n  const trackID = d3.select(this).attr('trackID');\n  let index = 0;\n  while (\n    index < inputTracks.length &&\n    inputTracks[index].id !== Number(trackID)\n  ) {\n    index += 1;\n  }\n  if (index >= inputTracks.length) return;\n  if (DEBUG) console.log(`moving index: ${index}`);\n  moveTrackToFirstPosition(index);\n  createTubeMap();\n}\n\n// Redraw with current node moved to beginning\nfunction nodeDoubleClick() {\n  /* jshint validthis: true */\n  const nodeID = d3.select(this).attr('id');\n  if (config.clickableNodesFlag) {\n    if (reads && config.showReads) {\n      document.getElementById('hgvmNodeID').value = nodeID;\n      document.getElementById('hgvmPostButton').click();\n    } else {\n      document.getElementById('nodeID').value = nodeID;\n      document.getElementById('postButton').click();\n    }\n  }\n}\n\n// extract info about nodes from vg-json\nexport function vgExtractNodes(vg) {\n  const result = [];\n  vg.node.forEach(node => {\n    result.push({\n      name: `${node.id}`,\n      sequenceLength: node.sequence.length,\n      seq: node.sequence\n    });\n  });\n  return result;\n}\n\n// calculate node widths depending on sequence lengths and chosen calculation method\nfunction generateNodeWidth() {\n  nodes.forEach(node => {\n    if (!node.hasOwnProperty('sequenceLength')) {\n      node.sequenceLength = node.seq.length;\n    }\n  });\n\n  switch (config.nodeWidthOption) {\n    case 1:\n      nodes.forEach(node => {\n        node.width = 1 + Math.log(node.sequenceLength) / Math.log(2);\n        node.pixelWidth = Math.round((node.width - 1) * 8.401);\n      });\n      break;\n    case 2:\n      nodes.forEach(node => {\n        node.width = node.sequenceLength / 100;\n        node.pixelWidth = Math.round((node.width - 1) * 8.401);\n      });\n      break;\n    default:\n      nodes.forEach(node => {\n        node.width = node.sequenceLength;\n\n        // get width of node's text label by writing label, measuring it and removing label\n        svg\n          .append('text')\n          .attr('x', 0)\n          .attr('y', 100)\n          .attr('id', 'dummytext')\n          .text(node.seq.substr(1))\n          .attr('font-family', 'Courier, \"Lucida Console\", monospace')\n          .attr('font-size', '14px')\n          .attr('fill', 'black')\n          .style('pointer-events', 'none');\n        node.pixelWidth = Math.round(\n          document.getElementById('dummytext').getComputedTextLength()\n        );\n        document.getElementById('dummytext').remove();\n        // $('#dummytext').remove();\n      });\n  }\n}\n\n// extract track info from vg-json\nexport function vgExtractTracks(vg) {\n  const result = [];\n  vg.path.forEach((path, index) => {\n    const sequence = [];\n    let isCompletelyReverse = true;\n    path.mapping.forEach(pos => {\n      if (\n        pos.position.hasOwnProperty('is_reverse') &&\n        pos.position.is_reverse === true\n      ) {\n        sequence.push(`-${pos.position.node_id}`);\n      } else {\n        sequence.push(`${pos.position.node_id}`);\n        isCompletelyReverse = false;\n      }\n    });\n    if (isCompletelyReverse) {\n      sequence.reverse();\n      sequence.forEach((node, index2) => {\n        sequence[index2] = node.substr(1);\n      });\n    }\n    const track = {};\n    track.id = index;\n    track.sequence = sequence;\n    if (path.hasOwnProperty('freq')) track.freq = path.freq;\n    if (path.hasOwnProperty('name')) track.name = path.name;\n    if (path.hasOwnProperty('indexOfFirstBase')) {\n      track.indexOfFirstBase = Number(path.indexOfFirstBase);\n    }\n    result.push(track);\n  });\n  return result;\n}\n\nfunction compareReadsByLeftEnd(a, b) {\n  let leftNodeA;\n  let leftNodeB;\n  let leftIndexA;\n  let leftIndexB;\n\n  if (a.sequence[0].charAt(0) === '-') {\n    if (a.sequence[a.sequence.length - 1].charAt(0) === '-') {\n      leftNodeA = a.sequence[a.sequence.length - 1].substr(1);\n      leftIndexA =\n        nodes[nodeMap.get(leftNodeA)].sequenceLength - a.finalNodeCoverLength;\n    } else {\n      leftNodeA = a.sequence[a.sequence.length - 1];\n      leftIndexA = 0;\n    }\n  } else {\n    leftNodeA = a.sequence[0];\n    leftIndexA = a.firstNodeOffset;\n  }\n\n  if (b.sequence[0].charAt(0) === '-') {\n    if (b.sequence[b.sequence.length - 1].charAt(0) === '-') {\n      leftNodeB = b.sequence[b.sequence.length - 1].substr(1);\n      leftIndexB =\n        nodes[nodeMap.get(leftNodeB)].sequenceLength - b.finalNodeCoverLength;\n    } else {\n      leftNodeB = b.sequence[b.sequence.length - 1];\n      leftIndexB = 0;\n    }\n  } else {\n    leftNodeB = b.sequence[0];\n    leftIndexB = b.firstNodeOffset;\n  }\n\n  if (leftNodeA < leftNodeB) return -1;\n  else if (leftNodeA > leftNodeB) return 1;\n  if (leftIndexA < leftIndexB) return -1;\n  else if (leftIndexA > leftIndexB) return 1;\n  return 0;\n}\n\nfunction compareReadsByLeftEnd2(a, b) {\n  // compare by order of first node\n  if (nodes[a.indexSequence[0]].order < nodes[b.indexSequence[0]].order) {\n    return -1;\n  } else if (\n    nodes[a.indexSequence[0]].order > nodes[b.indexSequence[0]].order\n  ) {\n    return 1;\n  }\n\n  // compare by first base within first node\n  if (a.firstNodeOffset < b.firstNodeOffset) return -1;\n  else if (a.firstNodeOffset > b.firstNodeOffset) return 1;\n\n  // compare by order of last node\n  if (\n    nodes[a.indexSequence[a.indexSequence.length - 1]].order <\n    nodes[b.indexSequence[b.indexSequence.length - 1]].order\n  ) {\n    return -1;\n  } else if (\n    nodes[a.indexSequence[a.indexSequence.length - 1]].order >\n    nodes[b.indexSequence[b.indexSequence.length - 1]].order\n  ) {\n    return 1;\n  }\n\n  // compare by last base withing last node\n  if (a.finalNodeCoverLength < b.finalNodeCoverLength) return -1;\n  else if (a.finalNodeCoverLength > b.finalNodeCoverLength) return 1;\n\n  return 0;\n}\n\nexport function vgExtractReads(myNodes, myTracks, myReads) {\n  if (DEBUG) {\n    console.log('Reads:');\n    console.log(myReads);\n  }\n  const extracted = [];\n\n  const nodeNames = [];\n  myNodes.forEach(node => {\n    nodeNames.push(node.name, 10);\n  });\n\n  for (let i = 0; i < myReads.length; i += 1) {\n    const read = myReads[i];\n    const sequence = [];\n    const sequenceNew = [];\n    let firstIndex = -1; // index within mapping of the first node id contained in nodeNames\n    let lastIndex = -1; // index within mapping of the last node id contained in nodeNames\n    read.path.mapping.forEach((pos, j) => {\n      if (nodeNames.indexOf(pos.position.node_id) > -1) {\n        const edit = {};\n        let offset = 0;\n        if (\n          pos.position.hasOwnProperty('is_reverse') &&\n          pos.position.is_reverse === true\n        ) {\n          sequence.push(`-${pos.position.node_id}`);\n          edit.nodeName = `-${pos.position.node_id}`;\n        } else {\n          sequence.push(`${pos.position.node_id}`);\n          edit.nodeName = pos.position.node_id.toString();\n        }\n        if (firstIndex < 0) {\n          firstIndex = j;\n          if (pos.position.hasOwnProperty('offset')) {\n            pos.position.offset = parseInt(pos.position.offset, 10);\n            offset = pos.position.offset;\n          }\n        }\n        lastIndex = j;\n\n        const mismatches = [];\n        let posWithinNode = offset;\n        pos.edit.forEach(element => {\n          if (\n            element.hasOwnProperty('to_length') &&\n            !element.hasOwnProperty('from_length')\n          ) {\n            // insertion\n            mismatches.push({\n              type: 'insertion',\n              pos: posWithinNode,\n              seq: element.sequence\n            });\n          } else if (\n            !element.hasOwnProperty('to_length') &&\n            element.hasOwnProperty('from_length')\n          ) {\n            // deletion\n            mismatches.push({\n              type: 'deletion',\n              pos: posWithinNode,\n              length: element.from_length\n            });\n          } else if (element.hasOwnProperty('sequence')) {\n            // substitution\n            if (element.sequence.length > 1) {\n              if (DEBUG) {\n                console.log(\n                  `found substitution at read ${i}, node ${j} = ${\n                    pos.position.node_id\n                  }, seq = ${element.sequence}`\n                );\n              }\n            }\n            mismatches.push({\n              type: 'substitution',\n              pos: posWithinNode,\n              seq: element.sequence\n            });\n          }\n          if (element.hasOwnProperty('from_length')) {\n            posWithinNode += element.from_length;\n          }\n        });\n        edit.mismatches = mismatches;\n        sequenceNew.push(edit);\n      }\n    });\n    if (sequence.length === 0) {\n      if (DEBUG) {\n        console.log(`read ${i} is empty`);\n      }\n    } else {\n      const track = {};\n      track.id = myTracks.length + extracted.length;\n      track.sequence = sequence;\n      track.sequenceNew = sequenceNew;\n      track.type = 'read';\n      if (read.path.hasOwnProperty('freq')) track.freq = read.path.freq;\n      if (read.path.hasOwnProperty('name')) track.name = read.path.name;\n\n      // where within node does read start\n      track.firstNodeOffset = 0;\n      if (read.path.mapping[firstIndex].position.hasOwnProperty('offset')) {\n        track.firstNodeOffset = read.path.mapping[firstIndex].position.offset;\n      }\n\n      // where within node does read end\n      const finalNodeEdit = read.path.mapping[lastIndex].edit;\n      track.finalNodeCoverLength = 0;\n      if (read.path.mapping[lastIndex].position.hasOwnProperty('offset')) {\n        track.finalNodeCoverLength +=\n          read.path.mapping[lastIndex].position.offset;\n      }\n      finalNodeEdit.forEach(edit => {\n        if (edit.hasOwnProperty('from_length')) {\n          track.finalNodeCoverLength += edit.from_length;\n        }\n      });\n\n      track.mapping_quality = read.mapping_quality || 0;\n      track.is_secondary = read.is_secondary || false;\n\n      extracted.push(track);\n    }\n  }\n  return extracted;\n}\n\n// remove redundant nodes\n// two nodes A and B can be merged if all tracks leaving A go directly into B\n// and all tracks entering B come directly from A\n// (plus no inversions involved)\nfunction mergeNodes() {\n  let nodeName;\n  let nodeName2;\n  const pred = []; // array of set of predecessors of each node\n  const succ = []; // array of set of successors of each node\n  for (let i = 0; i < nodes.length; i += 1) {\n    pred.push(new Set());\n    succ.push(new Set());\n  }\n\n  let tracksAndReads;\n  if (reads && config.showReads) tracksAndReads = tracks.concat(reads);\n  else tracksAndReads = tracks;\n\n  tracksAndReads.forEach(track => {\n    for (let i = 0; i < track.sequence.length; i += 1) {\n      if (track.sequence[i].charAt(0) !== '-') {\n        // forward Node\n        if (i > 0) {\n          nodeName = track.sequence[i - 1];\n          pred[nodeMap.get(track.sequence[i])].add(nodeName);\n          if (nodeName.charAt(0) === '-') {\n            // add 2 predecessors, to make sure there is no node merging in this case\n            pred[nodeMap.get(track.sequence[i])].add(nodeName.substr(1));\n          }\n        } else if (track.type === 'haplo') {\n          pred[nodeMap.get(track.sequence[i])].add('None');\n        }\n        if (i < track.sequence.length - 1) {\n          nodeName = track.sequence[i + 1];\n          succ[nodeMap.get(track.sequence[i])].add(nodeName);\n          if (nodeName.charAt(0) === '-') {\n            // add 2 successors, to make sure there is no node merging in this case\n            succ[nodeMap.get(track.sequence[i])].add(nodeName.substr(1));\n          }\n        } else if (track.type === 'haplo') {\n          succ[nodeMap.get(track.sequence[i])].add('None');\n        }\n      } else {\n        // reverse Node\n        nodeName = track.sequence[i].substr(1);\n        if (i > 0) {\n          nodeName2 = track.sequence[i - 1];\n          if (nodeName2.charAt(0) === '-') {\n            succ[nodeMap.get(nodeName)].add(nodeName2.substr(1));\n          } else {\n            // add 2 successors, to make sure there is no node merging in this case\n            succ[nodeMap.get(nodeName)].add(nodeName2);\n            succ[nodeMap.get(nodeName)].add(`-${nodeName2}`);\n          }\n        } else if (track.type === 'haplo') {\n          succ[nodeMap.get(nodeName)].add('None');\n        }\n        if (i < track.sequence.length - 1) {\n          nodeName2 = track.sequence[i + 1];\n          if (nodeName2.charAt(0) === '-') {\n            pred[nodeMap.get(nodeName)].add(nodeName2.substr(1));\n          } else {\n            pred[nodeMap.get(nodeName)].add(nodeName2);\n            pred[nodeMap.get(nodeName)].add(`-${nodeName2}`);\n          }\n        } else if (track.type === 'haplo') {\n          pred[nodeMap.get(nodeName)].add('None');\n        }\n      }\n    }\n  });\n\n  // convert sets to arrays\n  for (let i = 0; i < nodes.length; i += 1) {\n    succ[i] = Array.from(succ[i]);\n    pred[i] = Array.from(pred[i]);\n  }\n\n  // update reads which pass through merging nodes\n  if (reads && config.showReads) {\n    // sort nodes by order, then by y-coordinate\n    const sortedNodes = nodes.slice();\n    sortedNodes.sort(compareNodesByOrder);\n\n    // iterate over all nodes and calculate their position within the new merged node\n    const mergeOffset = new Map();\n    const mergeOrigin = new Map(); // maps to leftmost node of a node's \"merging cascade\"\n    sortedNodes.forEach(node => {\n      const predecessor = mergeableWithPred(nodeMap.get(node.name), pred, succ);\n      if (predecessor) {\n        mergeOffset.set(\n          node.name,\n          mergeOffset.get(predecessor) +\n            nodes[nodeMap.get(predecessor)].sequenceLength\n        );\n        mergeOffset.set(\n          '-' + node.name,\n          mergeOffset.get(predecessor) +\n            nodes[nodeMap.get(predecessor)].sequenceLength\n        );\n        mergeOrigin.set(node.name, mergeOrigin.get(predecessor));\n        mergeOrigin.set('-' + node.name, mergeOrigin.get(predecessor));\n      } else {\n        mergeOffset.set(node.name, 0);\n        mergeOffset.set('-' + node.name, 0);\n        mergeOrigin.set(node.name, node.name);\n        mergeOrigin.set('-' + node.name, node.name);\n      }\n    });\n\n    reads.forEach(read => {\n      read.firstNodeOffset += mergeOffset.get(read.sequence[0]);\n      read.finalNodeCoverLength += mergeOffset.get(\n        read.sequence[read.sequence.length - 1]\n      );\n      for (let i = read.sequence.length - 1; i >= 0; i -= 1) {\n        const nodeName =\n          read.sequence[i][0] === '-'\n            ? read.sequence[i].substr(1)\n            : read.sequence[i];\n        if (mergeableWithPred(nodeMap.get(nodeName), pred, succ)) {\n          const predecessor = mergeableWithPred(\n            nodeMap.get(nodeName),\n            pred,\n            succ\n          );\n          if (mergeableWithSucc(nodeMap.get(predecessor), pred, succ)) {\n            if (i > 0) {\n              read.sequence.splice(i, 1);\n              // adjust position of mismatches\n              read.sequenceNew[i].mismatches.forEach(mismatch => {\n                mismatch.pos += nodes[nodeMap.get(predecessor)].sequenceLength;\n              });\n              // append mismatches to previous entry's mismatches\n              read.sequenceNew[i - 1].mismatches = read.sequenceNew[\n                i - 1\n              ].mismatches.concat(read.sequenceNew[i].mismatches);\n              read.sequenceNew.splice(i, 1);\n            } else {\n              read.sequence[0] = mergeOrigin.get(read.sequence[0]);\n              read.sequenceNew[i].mismatches.forEach(mismatch => {\n                mismatch.pos += mergeOffset.get(read.sequenceNew[0].nodeName);\n              });\n              read.sequenceNew[0].nodeName = mergeOrigin.get(\n                read.sequenceNew[0].nodeName\n              );\n            }\n          }\n        }\n      }\n    });\n  }\n\n  // update node sequences + sequence lengths\n  for (let i = 0; i < nodes.length; i += 1) {\n    if (mergeableWithSucc(i, pred, succ) && !mergeableWithPred(i, pred, succ)) {\n      let donor = i;\n      while (mergeableWithSucc(donor, pred, succ)) {\n        donor = succ[donor][0];\n        if (donor.charAt(0) === '-') donor = donor.substr(1);\n        donor = nodeMap.get(donor);\n        if (nodes[i].hasOwnProperty('sequenceLength')) {\n          nodes[i].sequenceLength += nodes[donor].sequenceLength;\n        } else {\n          nodes[i].width += nodes[donor].width;\n        }\n        nodes[i].seq += nodes[donor].seq;\n      }\n    }\n  }\n\n  // actually merge the nodes by removing the corresponding nodes from track data\n  tracks.forEach(track => {\n    for (let i = track.sequence.length - 1; i >= 0; i -= 1) {\n      nodeName = track.sequence[i];\n      if (nodeName.charAt(0) === '-') nodeName = nodeName.substr(1);\n      const nodeIndex = nodeMap.get(nodeName);\n      if (mergeableWithPred(nodeIndex, pred, succ)) {\n        track.sequence.splice(i, 1);\n      }\n    }\n  });\n\n  // remove the nodes from node-array\n  for (let i = nodes.length - 1; i >= 0; i -= 1) {\n    if (mergeableWithPred(i, pred, succ)) {\n      nodes.splice(i, 1);\n    }\n  }\n}\n\nfunction mergeableWithPred(index, pred, succ) {\n  if (pred[index].length !== 1) return false;\n  if (pred[index][0] === 'None') return false;\n  let predecessor = pred[index][0];\n  if (predecessor.charAt(0) === '-') predecessor = predecessor.substr(1);\n  const predecessorIndex = nodeMap.get(predecessor);\n  if (succ[predecessorIndex].length !== 1) return false;\n  if (succ[predecessorIndex][0] === 'None') return false;\n  return predecessor;\n}\n\nfunction mergeableWithSucc(index, pred, succ) {\n  if (succ[index].length !== 1) return false;\n  if (succ[index][0] === 'None') return false;\n  let successor = succ[index][0];\n  if (successor.charAt(0) === '-') successor = successor.substr(1);\n  const successorIndex = nodeMap.get(successor);\n  if (pred[successorIndex].length !== 1) return false;\n  if (pred[successorIndex][0] === 'None') return false;\n  return true;\n}\n\nfunction drawMismatches() {\n  tracks.forEach((read, trackIdx) => {\n    if (read.type === 'read') {\n      read.sequenceNew.forEach((element, i) => {\n        element.mismatches.forEach(mm => {\n          const nodeName =\n            element.nodeName[0] === '-'\n              ? element.nodeName.substr(1)\n              : element.nodeName;\n          const nodeIndex = nodeMap.get(nodeName);\n          const node = nodes[nodeIndex];\n          const x = getXCoordinateOfBaseWithinNode(node, mm.pos);\n          let pathIndex = i;\n          while (read.path[pathIndex].node !== nodeIndex) pathIndex += 1;\n          const y = read.path[pathIndex].y;\n          if (mm.type === 'insertion') {\n            if (\n              config.showSoftClips ||\n              ((mm.pos !== read.firstNodeOffset || i !== 0) &&\n                (mm.pos !== read.finalNodeCoverLength ||\n                  i !== read.sequenceNew.length - 1))\n            ) {\n              drawInsertion(x - 3, y + 7, mm.seq, node.y);\n            }\n          } else if (mm.type === 'deletion') {\n            const x2 = getXCoordinateOfBaseWithinNode(node, mm.pos + mm.length);\n            drawDeletion(x, x2, y + 4, node.y);\n          } else if (mm.type === 'substitution') {\n            const x2 = getXCoordinateOfBaseWithinNode(\n              node,\n              mm.pos + mm.seq.length\n            );\n            drawSubstitution(x + 1, x2, y + 7, node.y, mm.seq);\n          }\n        });\n      });\n    }\n  });\n}\n\nfunction drawInsertion(x, y, seq, nodeY) {\n  svg\n    .append('text')\n    .attr('x', x)\n    .attr('y', y)\n    .text('*')\n    .attr('font-family', 'Courier, \"Lucida Console\", monospace')\n    .attr('font-size', '12px')\n    .attr('fill', 'black')\n    .attr('nodeY', nodeY)\n    .on('mouseover', insertionMouseOver)\n    .on('mouseout', insertionMouseOut)\n    .append('svg:title')\n    .text(seq);\n}\n\nfunction drawSubstitution(x1, x2, y, nodeY, seq) {\n  svg\n    .append('text')\n    .attr('x', x1)\n    .attr('y', y)\n    .text(seq)\n    .attr('font-family', 'Courier, \"Lucida Console\", monospace')\n    .attr('font-size', '12px')\n    .attr('fill', 'black')\n    .attr('nodeY', nodeY)\n    .attr('rightX', x2)\n    .on('mouseover', substitutionMouseOver)\n    .on('mouseout', substitutionMouseOut);\n}\n\nfunction drawDeletion(x1, x2, y, nodeY) {\n  // draw horizontal block\n  svg\n    .append('line')\n    .attr('x1', x1)\n    .attr('y1', y - 1)\n    .attr('x2', x2)\n    .attr('y2', y - 1)\n    .attr('stroke-width', 7)\n    .attr('stroke', 'grey')\n    .attr('nodeY', nodeY)\n    .on('mouseover', deletionMouseOver)\n    .on('mouseout', deletionMouseOut);\n}\n\nfunction insertionMouseOver() {\n  /* jshint validthis: true */\n  d3.select(this).attr('fill', 'red');\n  const x = Number(d3.select(this).attr('x'));\n  const y = Number(d3.select(this).attr('y'));\n  const yTop = Number(d3.select(this).attr('nodeY'));\n  svg\n    .append('line')\n    .attr('class', 'insertionHighlight')\n    .attr('x1', x + 4)\n    .attr('y1', y - 10)\n    .attr('x2', x + 4)\n    .attr('y2', yTop + 5)\n    .attr('stroke-width', 1)\n    .attr('stroke', 'black');\n}\n\nfunction deletionMouseOver() {\n  /* jshint validthis: true */\n  d3.select(this).attr('stroke', 'red');\n  const x1 = Number(d3.select(this).attr('x1'));\n  const x2 = Number(d3.select(this).attr('x2'));\n  const y = Number(d3.select(this).attr('y1'));\n  const yTop = Number(d3.select(this).attr('nodeY'));\n  svg\n    .append('line')\n    .attr('class', 'deletionHighlight')\n    .attr('x1', x1)\n    .attr('y1', y - 3)\n    .attr('x2', x1)\n    .attr('y2', yTop + 5)\n    .attr('stroke-width', 1)\n    .attr('stroke', 'black');\n  svg\n    .append('line')\n    .attr('class', 'deletionHighlight')\n    .attr('x1', x2)\n    .attr('y1', y - 3)\n    .attr('x2', x2)\n    .attr('y2', yTop + 5)\n    .attr('stroke-width', 1)\n    .attr('stroke', 'black');\n}\n\nfunction substitutionMouseOver() {\n  /* jshint validthis: true */\n  d3.select(this).attr('fill', 'red');\n  const x1 = Number(d3.select(this).attr('x'));\n  const x2 = Number(d3.select(this).attr('rightX'));\n  const y = Number(d3.select(this).attr('y'));\n  const yTop = Number(d3.select(this).attr('nodeY'));\n  svg\n    .append('line')\n    .attr('class', 'substitutionHighlight')\n    .attr('x1', x1 - 1)\n    .attr('y1', y - 7)\n    .attr('x2', x1 - 1)\n    .attr('y2', yTop + 5)\n    .attr('stroke-width', 1)\n    .attr('stroke', 'black');\n  svg\n    .append('line')\n    .attr('class', 'substitutionHighlight')\n    .attr('x1', x2 + 1)\n    .attr('y1', y - 7)\n    .attr('x2', x2 + 1)\n    .attr('y2', yTop + 5)\n    .attr('stroke-width', 1)\n    .attr('stroke', 'black');\n}\n\nfunction insertionMouseOut() {\n  /* jshint validthis: true */\n  d3.select(this).attr('fill', 'black');\n  d3.selectAll('.insertionHighlight').remove();\n}\n\nfunction deletionMouseOut() {\n  /* jshint validthis: true */\n  d3.select(this).attr('stroke', 'grey');\n  d3.selectAll('.deletionHighlight').remove();\n}\n\nfunction substitutionMouseOut() {\n  /* jshint validthis: true */\n  d3.select(this).attr('fill', 'black');\n  d3.selectAll('.substitutionHighlight').remove();\n}\n\nfunction filterReads(reads) {\n  if (!reads) return reads;\n  return reads.filter(\n    read =>\n      !read.is_secondary && read.mapping_quality >= config.mappingQualityCutoff\n  );\n}\n","export const dataOriginTypes = {\n  API: 'API',\n  EXAMPLE_1: 'example 1',\n  EXAMPLE_2: 'example 2',\n  EXAMPLE_3: 'example 3',\n  EXAMPLE_4: 'example 4',\n  EXAMPLE_5: 'example 5',\n  EXAMPLE_6: 'example 6'\n};\n","import React, { Component } from 'react';\nimport { Form, Label, Input, Button } from 'reactstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faStepBackward,\n  faStepForward,\n  faSearchPlus,\n  faSearchMinus\n} from '@fortawesome/free-solid-svg-icons';\nimport * as tubeMap from '../util/tubemap';\n\nconst ZOOM_FACTOR = 2.0;\n\nclass DataPositionFormRow extends Component {\n  handleZoomIn = () => {\n    tubeMap.zoomBy(ZOOM_FACTOR);\n  };\n\n  handleZoomOut = () => {\n    tubeMap.zoomBy(1.0 / ZOOM_FACTOR);\n  };\n\n  handleDownloadButton = () => {\n    const svgN = document.getElementById('svg');\n    const svgData = new XMLSerializer().serializeToString(svgN);\n    const svgBlob = new Blob([svgData], {\n      type: 'image/svg+xml;charset=utf-8'\n    });\n    const svgUrl = URL.createObjectURL(svgBlob);\n\n    const downloadLink = document.createElement('a');\n    downloadLink.href = svgUrl;\n    downloadLink.download = 'graph.svg';\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n  };\n\n  render() {\n    return (\n      <Form inline>\n        <Label className=\"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\" for=\"nodeID\">\n          Start:\n        </Label>\n        <Input\n          type=\"text\"\n          className=\"custom-input form-control mb-2 mr-sm-4 mb-sm-0\"\n          id=\"nodeID\"\n          size=\"12\"\n          value={this.props.nodeID}\n          onChange={this.props.handleInputChange}\n        />\n        <Label className=\"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\" for=\"distance\">\n          Length:\n        </Label>\n        <Input\n          type=\"text\"\n          className=\"custom-input form-control mb-2 mr-sm-2 mb-sm-0\"\n          id=\"distance\"\n          size=\"4\"\n          value={this.props.distance}\n          onChange={this.props.handleInputChange}\n        />\n        <Label\n          className=\"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n          for=\"unitSelect\"\n        >\n          Unit:\n        </Label>\n        <Input\n          type=\"select\"\n          className=\"custom-select mb-2 mr-sm-2 mb-sm-0\"\n          id=\"byNode\"\n          value={this.props.byNode}\n          onChange={this.props.handleInputChange}\n        >\n          <option value=\"false\">Nucleotides</option>\n          <option value=\"true\">Nodes</option>\n        </Input>\n        &nbsp;\n        {this.props.uploadInProgress && (\n          <div className=\"smallLoader\" id=\"fileUploadSpinner\" />\n        )}\n        <Button\n          color=\"primary\"\n          id=\"goButton\"\n          onClick={this.props.handleGoButton}\n          disabled={this.props.uploadInProgress}\n        >\n          Go\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"goLeftButton\"\n          onClick={this.props.handleGoLeft}\n        >\n          <FontAwesomeIcon icon={faStepBackward} size=\"lg\" />\n        </Button>\n        <Button color=\"primary\" id=\"zoomInButton\" onClick={this.handleZoomIn}>\n          <FontAwesomeIcon icon={faSearchPlus} size=\"lg\" />\n        </Button>\n        <Button color=\"primary\" id=\"zoomOutButton\" onClick={this.handleZoomOut}>\n          <FontAwesomeIcon icon={faSearchMinus} size=\"lg\" />\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"goRightButton\"\n          onClick={this.props.handleGoRight}\n        >\n          <FontAwesomeIcon icon={faStepForward} size=\"lg\" />\n        </Button>\n        <Button\n          color=\"secondary\"\n          id=\"downloadButton\"\n          onClick={this.handleDownloadButton}\n        >\n          Download Image\n        </Button>\n      </Form>\n    );\n  }\n}\n\nexport default DataPositionFormRow;\n","import React, { Component } from 'react';\nimport { Label, Input } from 'reactstrap';\n\nclass MountedDataFormRow extends Component {\n  render() {\n    const xgFileDropdownOptions = this.props.xgSelectOptions.map(fileName => {\n      return (\n        <option value={fileName} key={fileName}>\n          {fileName}\n        </option>\n      );\n    });\n\n    const gbwtFileDropdownOptions = this.props.gbwtSelectOptions.map(\n      fileName => {\n        return (\n          <option value={fileName} key={fileName}>\n            {fileName}\n          </option>\n        );\n      }\n    );\n\n    const gamFileDropdownOptions = this.props.gamSelectOptions.map(fileName => {\n      return (\n        <option value={fileName} key={fileName}>\n          {fileName}\n        </option>\n      );\n    });\n\n    const pathDropdownOptions = this.props.pathSelectOptions.map(pathName => {\n      return (\n        <option value={pathName} key={pathName}>\n          {pathName}\n        </option>\n      );\n    });\n\n    return (\n      <React.Fragment>\n        <Label className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\">\n          xg file:\n        </Label>\n        <Input\n          type=\"select\"\n          className=\"customDataMounted custom-select mb-2 mr-sm-4 mb-sm-0\"\n          id=\"xgSelect\"\n          value={this.props.xgSelect}\n          onChange={this.props.handleInputChange}\n        >\n          {xgFileDropdownOptions}\n        </Input>\n\n        <Label\n          for=\"gbwtFileSelect\"\n          className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n        >\n          gbwt file:\n        </Label>\n        <Input\n          type=\"select\"\n          className=\"customDataMounted custom-select mb-2 mr-sm-4 mb-sm-0\"\n          id=\"gbwtSelect\"\n          value={this.props.gbwtSelect}\n          onChange={this.props.handleInputChange}\n        >\n          {gbwtFileDropdownOptions}\n        </Input>\n\n        <Label\n          for=\"gamFileSelect\"\n          className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n        >\n          gam index:\n        </Label>\n        <Input\n          type=\"select\"\n          className=\"customDataMounted custom-select mb-2 mr-sm-4 mb-sm-0\"\n          id=\"gamSelect\"\n          value={this.props.gamSelect}\n          onChange={this.props.handleInputChange}\n        >\n          {gamFileDropdownOptions}\n        </Input>\n\n        <Label\n          for=\"pathName\"\n          className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n        >\n          Path name:\n        </Label>\n        <Input\n          type=\"select\"\n          className=\"customData custom-select mb-2 mr-sm-4 mb-sm-0\"\n          id=\"pathSelect\"\n          value={this.props.pathSelect}\n          onChange={this.props.handleInputChange}\n        >\n          {pathDropdownOptions}\n        </Input>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default MountedDataFormRow;\n","import React, { Component } from 'react';\nimport { Label, Input } from 'reactstrap';\nimport config from '../config.json';\n\nconst BACKEND_URL = config.BACKEND_URL || `http://${window.location.host}`;\nconst MAX_UPLOAD_SIZE = 5242880;\n\nclass FileUploadFormRow extends Component {\n  constructor(props) {\n    super(props);\n    this.xgFileInput = React.createRef();\n    this.gbwtFileInput = React.createRef();\n    this.gamFileInput = React.createRef();\n  }\n\n  onXgFileChange = () => {\n    const file = this.xgFileInput.current.files[0];\n    if (file === undefined) {\n      this.props.resetPathNames();\n      this.props.handleFileUpload('xgFile', 'none');\n    } else {\n      if (file.size > MAX_UPLOAD_SIZE) {\n        this.xgFileInput.current.value = '';\n        this.props.showFileSizeAlert();\n        return;\n      }\n      this.props.setUploadInProgress(true);\n      const formData = new FormData();\n      formData.append('xgFile', file);\n      const xhr = new XMLHttpRequest();\n      xhr.responseType = 'json';\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4 && xhr.status === 200) {\n          // Every thing ok, file uploaded\n          this.props.setUploadInProgress(false);\n          this.props.handleFileUpload('xgFile', xhr.response.path);\n          this.props.getPathNames(xhr.response.path, 'true');\n        }\n      };\n      xhr.open('POST', `${BACKEND_URL}/xgFileSubmission`, true);\n      xhr.send(formData);\n    }\n  };\n\n  onGbwtFileChange = () => {\n    const file = this.gbwtFileInput.current.files[0];\n    if (file === undefined) {\n      this.props.handleFileUpload('gbwtFile', 'none');\n    } else {\n      if (file.size > MAX_UPLOAD_SIZE) {\n        this.gbwtFileInput.current.value = '';\n        this.props.showFileSizeAlert();\n        return;\n      }\n      this.props.setUploadInProgress(true);\n      const formData = new FormData();\n      formData.append('gbwtFile', file);\n      const xhr = new XMLHttpRequest();\n      xhr.responseType = 'json';\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4 && xhr.status === 200) {\n          // Every thing ok, file uploaded\n          this.props.setUploadInProgress(false);\n          this.props.handleFileUpload('gbwtFile', xhr.response.path);\n        }\n      };\n      xhr.open('POST', `${BACKEND_URL}/gbwtFileSubmission`, true);\n      xhr.send(formData);\n    }\n  };\n\n  onGamFileChange = () => {\n    const file = this.gamFileInput.current.files[0];\n    if (file === undefined) {\n      this.props.handleFileUpload('gamFile', 'none');\n    } else {\n      if (file.size > MAX_UPLOAD_SIZE) {\n        this.gamFileInput.current.value = '';\n        this.props.showFileSizeAlert();\n        return;\n      }\n      this.props.setUploadInProgress(true);\n      const formData = new FormData();\n      formData.append('gamFile', file);\n      const xhr = new XMLHttpRequest();\n      xhr.responseType = 'json';\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === 4 && xhr.status === 200) {\n          // Every thing ok, file uploaded\n          this.props.setUploadInProgress(false);\n          this.props.handleFileUpload('gamFile', xhr.response.path);\n        }\n      };\n      xhr.open('POST', `${BACKEND_URL}/gamFileSubmission`, true);\n      xhr.send(formData);\n    }\n  };\n\n  render() {\n    const pathDropdownOptions = this.props.pathSelectOptions.map(pathName => {\n      return (\n        <option value={pathName} key={pathName}>\n          {pathName}\n        </option>\n      );\n    });\n\n    return (\n      <React.Fragment>\n        <Label className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\">\n          xg file:\n        </Label>\n        <Input\n          type=\"file\"\n          className=\"customDataUpload form-control-file\"\n          id=\"xgFileUpload\"\n          accept=\".xg\"\n          innerRef={this.xgFileInput}\n          onChange={this.onXgFileChange}\n        />\n        <Label\n          for=\"gbwtFileSelect\"\n          className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n        >\n          gbwt file:\n        </Label>\n        <Input\n          type=\"file\"\n          className=\"customDataUpload form-control-file\"\n          id=\"gbwtFileUpload\"\n          accept=\".gbwt\"\n          innerRef={this.gbwtFileInput}\n          onChange={this.onGbwtFileChange}\n        />\n        <Label\n          for=\"gamFileSelect\"\n          className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n        >\n          gam index:\n        </Label>\n        <Input\n          type=\"file\"\n          className=\"customDataUpload form-control-file\"\n          id=\"gamFileUpload\"\n          accept=\".gam\"\n          innerRef={this.gamFileInput}\n          onChange={this.onGamFileChange}\n        />\n        <Label\n          for=\"pathName\"\n          className=\"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n        >\n          Path name:\n        </Label>\n        <Input\n          type=\"select\"\n          className=\"customData custom-select mb-2 mr-sm-4 mb-sm-0\"\n          id=\"pathSelect\"\n          value={this.props.pathSelect}\n          onChange={this.props.handleInputChange}\n        >\n          {pathDropdownOptions}\n        </Input>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default FileUploadFormRow;\n","import React, { Component } from 'react';\nimport { Form, Button } from 'reactstrap';\nimport { dataOriginTypes } from '../enums';\n\nclass ExampleSelectButtons extends Component {\n  handleClick = (dataOrigin, haploColor, readColor) => {\n    this.props.setDataOrigin(dataOrigin);\n    this.props.setColorSetting('haplotypeColors', haploColor);\n    if (readColor) {\n      this.props.setColorSetting('forwardReadColors', readColor);\n    }\n  };\n\n  render() {\n    return (\n      <Form inline>\n        <Button\n          color=\"primary\"\n          id=\"example1\"\n          onClick={() =>\n            this.handleClick(dataOriginTypes.EXAMPLE_1, 'plainColors')\n          }\n        >\n          Indels and Polymorphisms only\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"example2\"\n          onClick={() =>\n            this.handleClick(dataOriginTypes.EXAMPLE_2, 'plainColors')\n          }\n        >\n          Inversions\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"example3\"\n          onClick={() =>\n            this.handleClick(dataOriginTypes.EXAMPLE_3, 'plainColors')\n          }\n        >\n          Nested Inversions\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"example4\"\n          onClick={() =>\n            this.handleClick(dataOriginTypes.EXAMPLE_4, 'plainColors')\n          }\n        >\n          Duplications\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"example5\"\n          onClick={() =>\n            this.handleClick(dataOriginTypes.EXAMPLE_5, 'plainColors')\n          }\n        >\n          Translocations\n        </Button>\n        <Button\n          color=\"primary\"\n          id=\"example6\"\n          onClick={() =>\n            this.handleClick(dataOriginTypes.EXAMPLE_6, 'greys', 'reds')\n          }\n        >\n          Aligned Reads\n        </Button>\n      </Form>\n    );\n  }\n}\n\nexport default ExampleSelectButtons;\n","import React, { Component } from 'react';\nimport { Container, Row, Col, Form, Label, Input, Alert } from 'reactstrap';\nimport { dataOriginTypes } from '../enums';\n// import defaultConfig from '../config.default.json';\nimport config from '../config.json';\nimport DataPositionFormRow from './DataPositionFormRow';\nimport MountedDataFormRow from './MountedDataFormRow';\nimport FileUploadFormRow from './FileUploadFormRow';\nimport ExampleSelectButtons from './ExampleSelectButtons';\n\nconst BACKEND_URL = config.BACKEND_URL || `http://${window.location.host}`;\nconst DATA_SOURCES = config.DATA_SOURCES;\nconst MAX_UPLOAD_SIZE_DESCRIPTION = '5 MB';\nconst dataTypes = {\n  BUILT_IN: 'built-in',\n  FILE_UPLOAD: 'file-upload',\n  MOUNTED_FILES: 'mounted files',\n  EXAMPLES: 'examples'\n};\n\nclass HeaderForm extends Component {\n  state = {\n    xgSelectOptions: ['none'],\n    xgSelect: 'none',\n\n    gbwtSelectOptions: ['none'],\n    gbwtSelect: 'none',\n\n    gamSelectOptions: ['none'],\n    gamSelect: 'none',\n\n    pathSelectOptions: ['none'],\n    pathSelect: 'none',\n\n    xgFile: 'snp1kg-BRCA1.vg.xg',\n    gbwtFile: '',\n    gamFile: 'NA12878-BRCA1.sorted.gam',\n    anchorTrackName: '17',\n    dataPath: 'default',\n\n    nodeID: '1',\n    distance: '100',\n    byNode: 'false',\n\n    dataType: dataTypes.BUILT_IN,\n    fileSizeAlert: false,\n    uploadInProgress: false\n  };\n\n  componentDidMount() {\n    this.getMountedFilenames();\n    this.setUpWebsocket();\n  }\n\n  getMountedFilenames = async () => {\n    try {\n      const response = await fetch(`${BACKEND_URL}/getFilenames`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      const json = await response.json();\n      json.xgFiles.unshift('none');\n      json.gbwtFiles.unshift('none');\n      json.gamIndices.unshift('none');\n\n      this.setState(state => {\n        const xgSelect = json.xgFiles.includes(state.xgSelect)\n          ? state.xgSelect\n          : 'none';\n        const gbwtSelect = json.gbwtFiles.includes(state.gbwtSelect)\n          ? state.gbwtSelect\n          : 'none';\n        const gamSelect = json.gamIndices.includes(state.gamSelect)\n          ? state.gamSelect\n          : 'none';\n        return {\n          xgSelectOptions: json.xgFiles,\n          gbwtSelectOptions: json.gbwtFiles,\n          gamSelectOptions: json.gamIndices,\n          xgSelect,\n          gbwtSelect,\n          gamSelect\n        };\n      });\n    } catch (error) {\n      console.log('POST to /getFilenames failed');\n    }\n  };\n\n  getPathNames = async (xgFile, isUploadedFile) => {\n    try {\n      const response = await fetch(`${BACKEND_URL}/getPathNames`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ xgFile, isUploadedFile })\n      });\n      const json = await response.json();\n      this.setState(state => {\n        const pathSelect = json.pathNames.includes(state.pathSelect)\n          ? state.pathSelect\n          : json.pathNames[0];\n        return {\n          pathSelectOptions: json.pathNames,\n          pathSelect,\n          anchorTrackName: pathSelect\n        };\n      });\n    } catch (error) {\n      console.log('POST to /getPathNames failed');\n    }\n  };\n\n  resetPathNames = () => {\n    this.setState({\n      pathSelectOptions: ['none'],\n      pathSelect: 'none'\n    });\n  };\n\n  handleDataSourceChange = event => {\n    const value = event.target.value;\n    DATA_SOURCES.forEach(ds => {\n      if (ds.name === value) {\n        this.setState({\n          xgFile: ds.xgFile,\n          gbwtFile: ds.gbwtFile,\n          gamFile: ds.gamFile,\n          anchorTrackName: ds.anchorTrackName,\n          dataPath: ds.useMountedPath ? 'mounted' : 'default',\n          nodeID: ds.defaultPosition,\n          dataType: dataTypes.BUILT_IN\n        });\n        return;\n      }\n    });\n    if (value === 'customFileUpload') {\n      this.setState(state => {\n        return {\n          xgFile: state.xgSelect,\n          gbwtFile: state.gbwtSelect,\n          gamFile: state.gamSelect,\n          anchorTrackName: state.pathSelect,\n          dataPath: 'upload',\n          dataType: dataTypes.FILE_UPLOAD\n        };\n      });\n    } else if (value === 'customMounted') {\n      this.setState(state => {\n        return {\n          xgFile: state.xgSelect,\n          gbwtFile: state.gbwtSelect,\n          gamFile: state.gamSelect,\n          anchorTrackName: state.pathSelect,\n          dataPath: 'mounted',\n          dataType: dataTypes.MOUNTED_FILES\n        };\n      });\n    } else if (value === 'syntheticExamples') {\n      this.setState({ dataType: dataTypes.EXAMPLES });\n    }\n  };\n\n  handleGoButton = () => {\n    if (this.props.dataOrigin !== dataOriginTypes.API) {\n      this.props.setColorSetting('haplotypeColors', 'greys');\n      this.props.setColorSetting('forwardReadColors', 'reds');\n    }\n    const fetchParams = {\n      nodeID: this.state.nodeID,\n      distance: this.state.distance,\n      byNode: this.state.byNode,\n      xgFile: this.state.xgFile,\n      gbwtFile: this.state.gbwtFile,\n      gamFile: this.state.gamFile,\n      anchorTrackName: this.state.anchorTrackName,\n      dataPath: this.state.dataPath\n    };\n    this.props.setFetchParams(fetchParams);\n  };\n\n  handleInputChange = event => {\n    const id = event.target.id;\n    const value = event.target.value;\n    this.setState({ [id]: value });\n    if (id === 'xgSelect') {\n      this.getPathNames(value, false);\n      this.setState({ xgFile: value });\n    } else if (id === 'gbwtSelect') {\n      this.setState({ gbwtFile: value });\n    } else if (id === 'gamSelect') {\n      this.setState({ gamFile: value });\n    } else if (id === 'pathSelect') {\n      this.setState({ anchorTrackName: value });\n    }\n  };\n\n  handleGoRight = () => {\n    this.setState(\n      state => ({\n        nodeID: Number(this.state.nodeID) + Number(this.state.distance)\n      }),\n      () => this.handleGoButton()\n    );\n  };\n\n  handleGoLeft = () => {\n    this.setState(\n      state => ({\n        nodeID: Math.max(\n          0,\n          Number(this.state.nodeID) - Number(this.state.distance)\n        )\n      }),\n      () => this.handleGoButton()\n    );\n  };\n\n  handleFileUpload = (fileType, fileName) => {\n    this.setState({ [fileType]: fileName });\n  };\n\n  showFileSizeAlert = () => {\n    this.setState({ fileSizeAlert: true });\n  };\n\n  setUploadInProgress = val => {\n    this.setState({ uploadInProgress: val });\n  };\n\n  setUpWebsocket = () => {\n    this.ws = new WebSocket(BACKEND_URL.replace(/^http/, 'ws'));\n    this.ws.onmessage = message => {\n      this.getMountedFilenames();\n    };\n    this.ws.onclose = event => {\n      setTimeout(this.setUpWebsocket, 1000);\n    };\n    this.ws.onerror = event => {\n      this.ws.close();\n    };\n  };\n\n  render() {\n    let dataSourceDropdownOptions = DATA_SOURCES.map(ds => {\n      return (\n        <option value={ds.name} key={ds.name}>\n          {ds.name}\n        </option>\n      );\n    });\n    dataSourceDropdownOptions.push(\n      <option value=\"syntheticExamples\" key=\"syntheticExamples\">\n        synthetic data examples\n      </option>,\n      <option value=\"customFileUpload\" key=\"customFileUpload\">\n        custom (file upload)\n      </option>,\n      <option value=\"customMounted\" key=\"customMounted\">\n        custom (mounted files)\n      </option>\n    );\n\n    const mountedFilesFlag = this.state.dataType === dataTypes.MOUNTED_FILES;\n    const uploadFilesFlag = this.state.dataType === dataTypes.FILE_UPLOAD;\n    const examplesFlag = this.state.dataType === dataTypes.EXAMPLES;\n\n    return (\n      <div>\n        <Container fluid={true}>\n          <Row>\n            <Col md=\"auto\">\n              <img src=\"./logo.png\" alt=\"Logo\" />\n            </Col>\n            <Col>\n              <Form inline>\n                <Label\n                  className=\"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2\"\n                  for=\"dataSourceSelect\"\n                >\n                  Data:\n                </Label>\n                <Input\n                  type=\"select\"\n                  id=\"dataSourceSelect\"\n                  className=\"custom-select mb-2 mr-sm-4 mb-sm-0\"\n                  onChange={this.handleDataSourceChange}\n                >\n                  {dataSourceDropdownOptions}\n                </Input>\n                {mountedFilesFlag && (\n                  <MountedDataFormRow\n                    xgSelect={this.state.xgSelect}\n                    xgSelectOptions={this.state.xgSelectOptions}\n                    gbwtSelect={this.state.gbwtSelect}\n                    gbwtSelectOptions={this.state.gbwtSelectOptions}\n                    gamSelect={this.state.gamSelect}\n                    gamSelectOptions={this.state.gamSelectOptions}\n                    pathSelect={this.state.pathSelect}\n                    pathSelectOptions={this.state.pathSelectOptions}\n                    handleInputChange={this.handleInputChange}\n                  />\n                )}\n                {uploadFilesFlag && (\n                  <FileUploadFormRow\n                    pathSelect={this.state.pathSelect}\n                    pathSelectOptions={this.state.pathSelectOptions}\n                    handleInputChange={this.handleInputChange}\n                    getPathNames={this.getPathNames}\n                    resetPathNames={this.resetPathNames}\n                    handleFileUpload={this.handleFileUpload}\n                    showFileSizeAlert={this.showFileSizeAlert}\n                    setUploadInProgress={this.setUploadInProgress}\n                  />\n                )}\n              </Form>\n              <Alert\n                color=\"danger\"\n                isOpen={this.state.fileSizeAlert}\n                toggle={() => {\n                  this.setState({ fileSizeAlert: false });\n                }}\n                className=\"mt-3\"\n              >\n                <strong>File size too big! </strong>\n                You may only upload files with a maximum size of{' '}\n                {MAX_UPLOAD_SIZE_DESCRIPTION}.\n              </Alert>\n              {examplesFlag ? (\n                <ExampleSelectButtons\n                  setDataOrigin={this.props.setDataOrigin}\n                  setColorSetting={this.props.setColorSetting}\n                />\n              ) : (\n                <DataPositionFormRow\n                  nodeID={this.state.nodeID}\n                  distance={this.state.distance}\n                  byNode={this.state.byNode}\n                  handleInputChange={this.handleInputChange}\n                  handleGoLeft={this.handleGoLeft}\n                  handleGoRight={this.handleGoRight}\n                  handleGoButton={this.handleGoButton}\n                  uploadInProgress={this.state.uploadInProgress}\n                />\n              )}\n            </Col>\n          </Row>\n        </Container>\n      </div>\n    );\n  }\n}\n\nexport default HeaderForm;\n","import React, { Component } from 'react';\nimport * as tubeMap from '../util/tubemap';\n\nclass TubeMap extends Component {\n  componentDidMount() {\n    this.createTubeMap();\n  }\n\n  componentDidUpdate() {\n    this.createTubeMap();\n  }\n\n  createTubeMap = () => {\n    tubeMap.create({\n      svgID: '#svg',\n      nodes: this.props.nodes,\n      tracks: this.props.tracks,\n      reads: this.props.reads\n    });\n  };\n\n  render() {\n    return <svg id=\"svg\" />;\n  }\n}\n\nexport default TubeMap;\n","import React, { Component } from 'react';\nimport TubeMap from './TubeMap';\nimport config from '../config.json';\nimport { Container, Row, Alert } from 'reactstrap';\nimport * as tubeMap from '../util/tubemap';\nimport { dataOriginTypes } from '../enums';\n\nconst BACKEND_URL = config.BACKEND_URL || `http://${window.location.host}`;\n\nclass TubeMapContainer extends Component {\n  state = {\n    isLoading: true,\n    error: null\n  };\n\n  componentDidMount() {\n    this.getRemoteTubeMapData();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.dataOrigin !== prevProps.dataOrigin) {\n      this.props.dataOrigin === dataOriginTypes.API\n        ? this.getRemoteTubeMapData()\n        : this.getExampleData();\n    } else if (this.props.fetchParams !== prevProps.fetchParams) {\n      this.getRemoteTubeMapData();\n    }\n  }\n\n  render() {\n    const { isLoading, error } = this.state;\n\n    if (error) {\n      console.log(error);\n      const message = error.message ? error.message : error;\n      return (\n        <Container>\n          <Row>\n            <Alert color=\"danger\">{message}</Alert>\n          </Row>\n        </Container>\n      );\n    }\n\n    if (isLoading) {\n      return (\n        <Container>\n          <Row>\n            <div id=\"loaderContainer\">\n              <div id=\"loader\" />\n            </div>\n          </Row>\n        </Container>\n      );\n    }\n\n    return (\n      <div id=\"tubeMapSVG\">\n        <TubeMap\n          nodes={this.state.nodes}\n          tracks={this.state.tracks}\n          reads={this.state.reads}\n        />\n      </div>\n    );\n  }\n\n  getRemoteTubeMapData = async () => {\n    this.setState({ isLoading: true, error: null });\n    try {\n      const response = await fetch(`${BACKEND_URL}/getChunkedData`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(this.props.fetchParams)\n      });\n      const json = await response.json();\n      if (json.graph === undefined) {\n        // We did not get back a graph, only (possibly) an error.\n        const error = json.error || 'Fetching remote data returned error';\n        this.setState({ error: error, isLoading: false });\n      } else {\n        const nodes = tubeMap.vgExtractNodes(json.graph);\n        const tracks = tubeMap.vgExtractTracks(json.graph);\n        const reads = tubeMap.vgExtractReads(nodes, tracks, json.gam);\n        this.setState({\n          isLoading: false,\n          nodes,\n          tracks,\n          reads\n        });\n      }\n    } catch (error) {\n      this.setState({ error: error, isLoading: false });\n    }\n  };\n\n  getExampleData = async () => {\n    this.setState({ isLoading: true, error: null });\n    let nodes, tracks, reads;\n    const data = await import('../util/demo-data');\n    nodes = data.inputNodes;\n    switch (this.props.dataOrigin) {\n      case dataOriginTypes.EXAMPLE_1:\n        tracks = data.inputTracks1;\n        break;\n      case dataOriginTypes.EXAMPLE_2:\n        tracks = data.inputTracks2;\n        break;\n      case dataOriginTypes.EXAMPLE_3:\n        tracks = data.inputTracks3;\n        break;\n      case dataOriginTypes.EXAMPLE_4:\n        tracks = data.inputTracks4;\n        break;\n      case dataOriginTypes.EXAMPLE_5:\n        tracks = data.inputTracks5;\n        break;\n      case dataOriginTypes.EXAMPLE_6:\n        const vg = JSON.parse(data.k3138);\n        nodes = tubeMap.vgExtractNodes(vg);\n        tracks = tubeMap.vgExtractTracks(vg);\n        reads = tubeMap.vgExtractReads(\n          nodes,\n          tracks,\n          this.readsFromStringToArray(data.demoReads)\n        );\n        break;\n      default:\n        console.log('invalid data origin type');\n    }\n\n    this.setState({ isLoading: false, nodes, tracks, reads });\n  };\n\n  readsFromStringToArray = readsString => {\n    const lines = readsString.split('\\n');\n    const result = [];\n    lines.forEach(line => {\n      if (line.length > 0) {\n        result.push(JSON.parse(line));\n      }\n    });\n    return result;\n  };\n}\n\nexport default TubeMapContainer;\n","import React, { Component } from 'react';\nimport { Col, Label, Input, FormGroup } from 'reactstrap';\n\nconst colorMap = new Map([\n  ['colorful', 'plainColors'],\n  ['greyscale', 'greys'],\n  ['reds', 'reds'],\n  ['blues', 'blues'],\n  ['pale colors', 'lightColors']\n]);\n\nclass RadioRow extends Component {\n  onChange = event => {\n    this.props.setColorSetting(\n      this.props.trackType,\n      colorMap.get(event.target.value)\n    );\n  };\n\n  render() {\n    const colorRadios = Array.from(colorMap).map(([keyColor, valueColor]) => {\n      return (\n        <Col xs=\"auto\" key={keyColor}>\n          <FormGroup check>\n            <Label check>\n              <Input\n                type=\"radio\"\n                value={keyColor}\n                checked={this.props.color === valueColor}\n                onChange={this.onChange}\n              />\n              {keyColor}\n            </Label>\n          </FormGroup>\n        </Col>\n      );\n    });\n    return (\n      <FormGroup row className=\"mb-1\">\n        <Col sm=\"2\">{this.props.rowHeading}:</Col>\n        {colorRadios}\n      </FormGroup>\n    );\n  }\n}\n\nexport default RadioRow;\n","import React, { Component } from 'react';\nimport {\n  Container,\n  Collapse,\n  CardBody,\n  Card,\n  CardHeader,\n  Form,\n  Label,\n  Input,\n  FormGroup\n} from 'reactstrap';\nimport RadioRow from './RadioRow';\n\nclass VisualizationOptions extends Component {\n  state = {\n    isOpenLegend: false,\n    isOpenVisualizationOptions: true\n  };\n\n  toggleLegend = e => {\n    this.setState({ isOpenLegend: !this.state.isOpenLegend });\n    e.preventDefault();\n  };\n\n  toggleVisOptions = e => {\n    this.setState({\n      isOpenVisualizationOptions: !this.state.isOpenVisualizationOptions\n    });\n    e.preventDefault();\n  };\n\n  handleMappingQualityCutoffChange = event => {\n    this.props.handleMappingQualityCutoffChange(event.target.value);\n  };\n\n  render() {\n    const { visOptions, toggleFlag } = this.props;\n    const mappingQualityOptions = Array.from(Array(61).keys()).map(i => {\n      return (\n        <option value={i} key={i}>\n          {i}\n        </option>\n      );\n    });\n    return (\n      <Container>\n        <div id=\"accordion\">\n          <Card>\n            <CardHeader id=\"legendCard\">\n              <h5 className=\"mb-0\">\n                <a href=\"#collapse\" onClick={this.toggleLegend}>\n                  Legend\n                </a>\n              </h5>\n            </CardHeader>\n            <Collapse isOpen={this.state.isOpenLegend}>\n              <CardBody>\n                <div id=\"legendDiv\" />\n              </CardBody>\n            </Collapse>\n          </Card>\n\n          <Card>\n            <CardHeader id=\"visOptionsCard\">\n              <h5 className=\"mb-0\">\n                <a href=\"#collapse\" onClick={this.toggleVisOptions}>\n                  Visualization Options\n                </a>\n              </h5>\n            </CardHeader>\n            <Collapse isOpen={this.state.isOpenVisualizationOptions}>\n              <CardBody>\n                <FormGroup>\n                  <h5>General</h5>\n                  <FormGroup check>\n                    <Label check>\n                      <Input\n                        type=\"checkbox\"\n                        checked={visOptions.removeRedundantNodes}\n                        onChange={() => toggleFlag('removeRedundantNodes')}\n                      />\n                      Remove redundant nodes\n                    </Label>\n                  </FormGroup>\n                  <FormGroup check>\n                    <Label check>\n                      <Input\n                        type=\"checkbox\"\n                        checked={visOptions.compressedView}\n                        onChange={() => toggleFlag('compressedView')}\n                      />\n                      Compressed view\n                    </Label>\n                  </FormGroup>\n                </FormGroup>\n\n                <FormGroup>\n                  <h5>Sequence Reads</h5>\n                  <FormGroup check>\n                    <Label check>\n                      <Input\n                        type=\"checkbox\"\n                        checked={visOptions.showReads}\n                        onChange={() => toggleFlag('showReads')}\n                      />\n                      Show sequence reads\n                    </Label>\n                  </FormGroup>\n                  {visOptions.showReads && (\n                    <React.Fragment>\n                      <FormGroup check>\n                        <Label check>\n                          <Input\n                            type=\"checkbox\"\n                            checked={visOptions.showSoftClips}\n                            onChange={() => toggleFlag('showSoftClips')}\n                          />\n                          Show soft clips\n                        </Label>\n                      </FormGroup>\n                      <FormGroup check>\n                        <Label check>\n                          <Input\n                            type=\"checkbox\"\n                            checked={visOptions.colorReadsByMappingQuality}\n                            onChange={() =>\n                              toggleFlag('colorReadsByMappingQuality')\n                            }\n                          />\n                          Color reads by mapping quality\n                        </Label>\n                      </FormGroup>\n                      <Form inline>\n                        <Label className=\"mr-sm-2 \" for=\"dataSourceSelect\">\n                          Mapping Quality Cutoff:\n                        </Label>\n                        <Input\n                          type=\"select\"\n                          id=\"dataSourceSelect\"\n                          className=\"custom-select\"\n                          value={visOptions.mappingQualityCutoff}\n                          onChange={this.handleMappingQualityCutoffChange}\n                        >\n                          {mappingQualityOptions}\n                        </Input>\n                      </Form>\n                    </React.Fragment>\n                  )}\n                </FormGroup>\n\n                <h5>Colors</h5>\n                <Form>\n                  <RadioRow\n                    rowHeading=\"Haplotypes\"\n                    color={visOptions.haplotypeColors}\n                    trackType=\"haplotypeColors\"\n                    setColorSetting={this.props.setColorSetting}\n                  />\n                  {visOptions.showReads &&\n                    !visOptions.colorReadsByMappingQuality && (\n                      <React.Fragment>\n                        <RadioRow\n                          rowHeading=\"Reads (forward strand)\"\n                          color={visOptions.forwardReadColors}\n                          trackType=\"forwardReadColors\"\n                          setColorSetting={this.props.setColorSetting}\n                        />\n                        <RadioRow\n                          rowHeading=\"Reads (reverse strand)\"\n                          color={visOptions.reverseReadColors}\n                          trackType=\"reverseReadColors\"\n                          setColorSetting={this.props.setColorSetting}\n                        />\n                      </React.Fragment>\n                    )}\n                </Form>\n              </CardBody>\n            </Collapse>\n          </Card>\n        </div>\n      </Container>\n    );\n  }\n}\n\nexport default VisualizationOptions;\n","import React, { Component } from 'react';\nimport './App.css';\nimport HeaderForm from './components/HeaderForm';\nimport TubeMapContainer from './components/TubeMapContainer';\nimport CustomizationAccordion from './components/CustomizationAccordion';\nimport { dataOriginTypes } from './enums';\nimport * as tubeMap from './util/tubemap';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      fetchParams: {\n        nodeID: '1',\n        distance: '100',\n        byNode: 'false',\n        xgFile: 'snp1kg-BRCA1.vg.xg',\n        gbwtFile: '',\n        gamFile: 'NA12878-BRCA1.sorted.gam',\n        anchorTrackName: '17',\n        dataPath: 'default'\n      },\n      dataOrigin: dataOriginTypes.API,\n      visOptions: {\n        removeRedundantNodes: true,\n        compressedView: false,\n        showReads: true,\n        showSoftClips: true,\n        haplotypeColors: 'greys',\n        forwardReadColors: 'reds',\n        reverseReadColors: 'blues',\n        colorReadsByMappingQuality: false,\n        mappingQualityCutoff: 0\n      }\n    };\n  }\n\n  componentDidUpdate() {\n    const { visOptions } = this.state;\n    visOptions.compressedView\n      ? tubeMap.setNodeWidthOption(1)\n      : tubeMap.setNodeWidthOption(0);\n    tubeMap.setMergeNodesFlag(visOptions.removeRedundantNodes);\n    tubeMap.setShowReadsFlag(visOptions.showReads);\n    tubeMap.setSoftClipsFlag(visOptions.showSoftClips);\n    tubeMap.setColorSet('haplotypeColors', visOptions.haplotypeColors);\n    tubeMap.setColorSet('forwardReadColors', visOptions.forwardReadColors);\n    tubeMap.setColorSet('reverseReadColors', visOptions.reverseReadColors);\n    tubeMap.setColorReadsByMappingQualityFlag(\n      visOptions.colorReadsByMappingQuality\n    );\n    tubeMap.setMappingQualityCutoff(visOptions.mappingQualityCutoff);\n  }\n\n  setFetchParams = fetchParams => {\n    this.setState({\n      fetchParams: fetchParams,\n      dataOrigin: dataOriginTypes.API\n    });\n  };\n\n  toggleVisOptionFlag = flagName => {\n    this.setState(state => ({\n      visOptions: {\n        ...state.visOptions,\n        [flagName]: !state.visOptions[flagName]\n      }\n    }));\n  };\n\n  handleMappingQualityCutoffChange = value => {\n    this.setState(state => ({\n      visOptions: {\n        ...state.visOptions,\n        mappingQualityCutoff: value\n      }\n    }));\n  };\n\n  setColorSetting = (key, value) => {\n    this.setState(state => ({\n      visOptions: {\n        ...state.visOptions,\n        [key]: value\n      }\n    }));\n  };\n\n  setDataOrigin = dataOrigin => {\n    this.setState({ dataOrigin });\n  };\n\n  render() {\n    return (\n      <div>\n        <HeaderForm\n          setFetchParams={this.setFetchParams}\n          setDataOrigin={this.setDataOrigin}\n          setColorSetting={this.setColorSetting}\n          dataOrigin={this.state.dataOrigin}\n        />\n        <TubeMapContainer\n          fetchParams={this.state.fetchParams}\n          dataOrigin={this.state.dataOrigin}\n        />\n        <CustomizationAccordion\n          visOptions={this.state.visOptions}\n          toggleFlag={this.toggleVisOptionFlag}\n          handleMappingQualityCutoffChange={\n            this.handleMappingQualityCutoffChange\n          }\n          setColorSetting={this.setColorSetting}\n        />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}